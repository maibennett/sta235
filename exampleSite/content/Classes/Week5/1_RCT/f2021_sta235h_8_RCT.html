<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>STA 235H - Randomized Controlled Trials II</title>
    <meta charset="utf-8" />
    <meta name="author" content="McCombs School of Business, UT Austin" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <script src="libs/clipboard/clipboard.min.js"></script>
    <link href="libs/xaringanExtra-clipboard/xaringanExtra-clipboard.css" rel="stylesheet" />
    <script src="libs/xaringanExtra-clipboard/xaringanExtra-clipboard.js"></script>
    <script>window.xaringanExtraClipboard(null, {"button":"<i class=\"fa fa-clipboard\"><\/i>","success":"<i class=\"fa fa-check\" style=\"color: #90BE6D\"><\/i>","error":"<i class=\"fa fa-times-circle\" style=\"color: #F94144\"><\/i>"})</script>
    <link href="libs/font-awesome/css/all.css" rel="stylesheet" />
    <link href="libs/font-awesome/css/v4-shims.css" rel="stylesheet" />
    <script src="libs/kePrint/kePrint.js"></script>
    <link href="libs/lightable/lightable.css" rel="stylesheet" />
    <script src="libs/core-js/shim.min.js"></script>
    <script src="libs/react/react.min.js"></script>
    <script src="libs/react/react-dom.min.js"></script>
    <script src="libs/reactwidget/react-tools.js"></script>
    <script src="libs/htmlwidgets/htmlwidgets.js"></script>
    <script src="libs/reactable-binding/reactable.js"></script>
    <script src="https://use.fontawesome.com/5235085b15.js"></script>
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# STA 235H - Randomized Controlled Trials II
## Fall 2021
### McCombs School of Business, UT Austin

---


&lt;!-- &lt;script type="text/javascript"&gt; --&gt;
&lt;!-- MathJax.Hub.Config({ --&gt;
&lt;!--   "HTML-CSS": { --&gt;
&lt;!--     preferredFont: null, --&gt;
&lt;!--     webFont:  "Neo-Euler" --&gt;
&lt;!--   } --&gt;
&lt;!-- }); --&gt;
&lt;!-- &lt;/script&gt; --&gt;




&lt;style type="text/css"&gt;

.small .remark-code { /*Change made here*/
  font-size: 80% !important;
}

.tiny .remark-code { /*Change made here*/
  font-size: 90% !important;
}
&lt;/style&gt;




# Some announcements

.box-4LA[Homework 2 is due on Thursday]

&lt;br&gt;

--


- Please remember to (1) &lt;u&gt;submit on time&lt;/u&gt; or (2) &lt;u&gt;fill out the extension form&lt;/u&gt;

  - Reach out to the instruction team if you have any issues.
  
--

- Following the analytics for the course website, **.darkorange[less than 50% of students check out the R code]**:

  - Review the scripts and answer the questions there! (good practice for the midterm, too).

---
# Last week

.pull-left[

![:scale 80%](https://media.giphy.com/media/YMwRxPhWq5SoIBPvMY/giphy.gif?cid=ecf05e47xugy72kyps7kvffoanb4duyaufr9d8um1kdplohn&amp;rid=giphy.gif&amp;ct=g)
]
.pull-right[
- Finished our chapter on **.darkorange[causal inference framework]**.

- Started talking about **.darkorange[Randomized Controlled Trials]**:

  .box-2[Assumptions: The power of randomization]
]

---
# Today

.pull-left[
- Continue with **.darkorange[randomized controlled trials]**:

  .box-4[Design: What should we consider?]
  
  .box-7[Limitations: Gold Standard?]
  
- Comparison between **.darkorange[observational]** studies and **.darkorange[RCTs]**
  
]

.pull-right[
![](https://media.giphy.com/media/l3dj09hpsfuYkijDi/giphy.gif?cid=ecf05e47u8xm2usaj4n89v5gkwypeewheumjciut4l3vw5ph&amp;rid=giphy.gif&amp;ct=g)
]
---
background-position: 50% 50%
class: left, bottom, inverse
.big[
Design: How do we randomize?
]


---
# How do we randomize?


.box-5[Coin flip*]

--

E.g., in `R`:


```r
id &lt;- seq(1,1000)

set.seed(100)

data &lt;- data.frame("id" = id) %&gt;% mutate(z = sample(c(0,1), size = 1000, 
                                                    replace = TRUE,
                                                    prob = c(0.5, 0.5)))
```

---
# How do we randomize?

.box-5[Coin flip*]

E.g., in `R`:


```r
id &lt;- seq(1,1000)

*set.seed(100)

data &lt;- data.frame("id" = id) %&gt;% mutate(z = sample(c(0,1), size = 1000, 
                                                    replace = TRUE,
                                                    prob = c(0.5, 0.5)))
```

---
# How do we randomize?

.box-5[Coin flip*]

E.g., in `R`:


```r
id &lt;- seq(1,1000)

set.seed(100)

*data &lt;- data.frame("id" = id) %&gt;% mutate(z = sample(c(0,1), size = 1000,
*                                                   replace = TRUE,
*                                                   prob = c(0.5, 0.5)))
```

---
# How do we randomize?

.box-5[Coin flip*]

E.g., in `R`:


```r
id &lt;- seq(1,1000)

set.seed(100)

data &lt;- data.frame("id" = id) %&gt;% mutate(z = sample(c(0,1), size = 1000,
                                                    replace = TRUE,
                                                    prob = c(0.5, 0.5)))

*data %&gt;% group_by(z) %&gt;% count()
```
---
# How do we randomize?

.box-5[Coin flip*]

E.g., in `R`:


```r
id &lt;- seq(1,1000)

set.seed(100)

data &lt;- data.frame("id" = id) %&gt;% mutate(z = sample(c(0,1), size = 1000,
                                                    replace = TRUE,
                                                    prob = c(0.5, 0.5)))

*data %&gt;% group_by(z) %&gt;% count()
```

```
## # A tibble: 2 x 2
## # Groups:   z [2]
##       z     n
##   &lt;dbl&gt; &lt;int&gt;
## 1     0   516
## 2     1   484
```

---
.center2[
.box-3LA[How do we check that randomization was done correctly?]
]

---
# Checking for balance

.small[

```r
library(modelsummary)

d &lt;- read.csv("https://raw.githubusercontent.com/maibennett/sta235/main/exampleSite/content/Classes/Week4/2_RCT/data/covariates_example.csv")

head (round(d,3))
```

```
##   id z     x1     x2     x3     x4     x5     x6     x7     x8     x9    x10
## 1  1 1 -0.626 -0.897 -0.962  0.217 -0.841  0.270  2.287 -0.085 -0.767  0.019
## 2  2 1  0.184  0.185 -0.293 -0.542  1.384 -0.630 -1.197  0.840 -0.816 -0.184
## 3  3 0 -0.836  1.588  0.259  0.891 -1.255  0.869 -0.694 -0.463 -0.142 -1.371
## 4  4 1  1.595 -1.130 -1.152  0.596  0.070  1.727 -0.412 -0.551 -0.278 -0.599
## 5  5 0  0.330 -0.080  0.196  1.636  1.711  0.024 -0.971  0.736  0.436  0.295
## 6  6 0 -0.820  0.132  0.030  0.689 -0.603  0.368 -0.947 -0.108 -1.187  0.390
##      x11    x12    x13    x14    x15    x16    x17    x18    x19    x20
## 1 -0.591 -1.481  0.554 -0.662  0.259  0.476 -1.015  0.926 -1.189  1.163
## 2  0.027  1.577 -0.280  1.719  1.831 -0.125 -0.080  1.823  0.389 -0.586
## 3 -1.517 -0.957  1.775  2.122 -0.340  1.096 -0.233 -1.611 -0.344  1.785
## 4 -1.363 -0.920  0.187  1.497  0.897 -1.444 -0.817 -0.285 -0.548 -1.333
## 5  1.178 -1.998  1.143 -0.036  0.488  1.148  0.772 -0.342  0.981 -0.447
## 6 -0.934 -0.272  0.416  1.232 -1.255 -0.468 -0.166  0.366 -0.237  0.570
```
]
---
# Checking for balance

.pull-left[
.small[

```r
d_bal &lt;- d %&gt;% select(z, starts_with("x"))

datasummary_balance(~ z, data = d_bal, fmt = 2, dinm_statistic = "p.value")
```

&lt;table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;"&gt;
 &lt;thead&gt;
&lt;tr&gt;
&lt;th style="empty-cells: hide;border-bottom:hidden;" colspan="1"&gt;&lt;/th&gt;
&lt;th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2"&gt;&lt;div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; "&gt;0&lt;/div&gt;&lt;/th&gt;
&lt;th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2"&gt;&lt;div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; "&gt;1&lt;/div&gt;&lt;/th&gt;
&lt;th style="empty-cells: hide;border-bottom:hidden;" colspan="1"&gt;&lt;/th&gt;
&lt;th style="empty-cells: hide;border-bottom:hidden;" colspan="1"&gt;&lt;/th&gt;
&lt;/tr&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;   &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Mean &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Std. Dev. &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Mean  &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Std. Dev.  &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Diff. in Means &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; p &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; x1 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; -0.07 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1.04 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.04 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1.03 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.11 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.09 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; x2 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.06 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1.03 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.06 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1.00 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.00 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.98 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; x3 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.01 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.99 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.01 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1.00 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.00 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.99 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; x4 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; -0.03 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1.00 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; -0.04 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.94 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.00 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.96 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; x5 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.03 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1.01 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.01 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1.01 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; -0.02 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.77 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; x6 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; -0.08 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.99 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.03 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1.02 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.12 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.07 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; x7 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.03 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.98 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; -0.03 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.98 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; -0.06 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.31 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; x8 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; -0.02 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1.00 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; -0.07 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1.05 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; -0.05 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.45 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; x9 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.00 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.92 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.01 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1.00 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.02 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.77 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; x10 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; -0.01 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1.01 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.03 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.98 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.04 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.55 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; x11 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.04 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1.00 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; -0.02 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.99 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; -0.06 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.36 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; x12 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; -0.01 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1.00 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; -0.04 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.92 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; -0.02 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.69 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; x13 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.01 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1.00 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; -0.01 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1.00 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; -0.02 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.71 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; x14 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; -0.04 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1.02 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; -0.02 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1.07 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.02 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.82 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; x15 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.04 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1.04 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.04 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1.01 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.00 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.98 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; x16 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.04 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.97 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.04 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.99 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.00 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.95 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; x17 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; -0.01 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1.02 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.05 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1.01 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.06 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.33 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; x18 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.00 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1.05 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; -0.08 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1.00 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; -0.08 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.20 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; x19 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; -0.03 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.98 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.02 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.98 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.04 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.49 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; x20 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.00 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.99 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; -0.03 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1.05 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; -0.04 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.58 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
]]
.pull-right[
- **.darkorange[Columns of interest]**:

  - Diff in Means: Difference in means between treat (col. 3) and control group (col. 1)
  
  - p: P-value for the difference in means (whether is statistically significant or not.)
]

---
.center2[.box-6LA[Randomization assures balance *in expectation*]]

---
# Can we ensure balance?

- In RCTs, in general, you can't ensure balance on all covariates.

- But you can **.darkorange[stratify]**!
--

- Stratification means dividing your data into different stratas or groups *S*, based on one or more covariates.

- Then, you randomize in the same way *within strata*.

---
# Randomization of treatment

.center[
![:scale 80%](https://raw.githubusercontent.com/maibennett/sta235/main/exampleSite/content/Classes/Week5/1_RCT/images/study1.png)
]

---
# Randomization of treatment with no strata

.center[
![:scale 80%](https://raw.githubusercontent.com/maibennett/sta235/main/exampleSite/content/Classes/Week5/1_RCT/images/study2.png)
]

---
# Randomization of treatment with strata

.center[
![:scale 80%](https://raw.githubusercontent.com/maibennett/sta235/main/exampleSite/content/Classes/Week5/1_RCT/images/study3.png)
]

---
background-position: 50% 50%
class: left, bottom, inverse
.big[
RCTs in Practice
]

---
# Let's look at some data

.pull-left[
- "Get out the Vote" Large-Scale Mobilization experiment (Arceneaux, Gerber, and Green, 2006)
  
  - "Households containing one or two registered voters where **.darkorange[randomly assigned]** to treatment or control groups"
  
  - Treatment: GOTV phone calls
  
  - Stratified RCT: Two states divided into competitive and noncompetitive 
]
.pull-right[
![:scale 100%](https://raw.githubusercontent.com/maibennett/sta235/main/exampleSite/content/Classes/Week5/1_RCT/images/vote.jpg)
]

---
# Checking for balance

.small[
<div class="tab">
<div class="title">
<h3>Balance Table by Stratum</h3>
</div>
<div id="htmlwidget-8087b52accdd5640d275" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-8087b52accdd5640d275">{"x":{"tag":{"name":"Reactable","attribs":{"data":{".rownames":["female2","fem_miss","age","newreg","persons","vote98","vote00"],"V1":[0.552,0,52.157,0.117,1.496,0.231,0.564],"V2":[0.546,0,51.977,0.116,1.497,0.227,0.567],"V3":[0.541,0,50.81,0.133,1.513,0.258,0.595],"V4":[0.535,0,50.862,0.134,1.518,0.259,0.593],"V5":[0.549,0.026,55.795,0.048,1.539,0.572,0.734],"V6":[0.545,0.025,55.782,0.049,1.538,0.574,0.732],"V7":[0.543,0.022,53.481,0.048,1.529,0.599,0.781],"V8":[0.541,0.021,53.464,0.046,1.533,0.594,0.78]},"columns":[{"accessor":".rownames","name":"","type":"character","align":"center","sortable":false,"filterable":false},{"accessor":"V1","name":"Treat","type":"numeric","align":"center"},{"accessor":"V2","name":"Control","type":"numeric","align":"center","style":{"borderRight":"1px solid rgba(0, 0, 0, 0.1)"}},{"accessor":"V3","name":"Treat","type":"numeric","align":"center"},{"accessor":"V4","name":"Control","type":"numeric","align":"center","style":{"borderRight":"3px solid rgba(0, 0, 0, 0.1)"}},{"accessor":"V5","name":"Treat","type":"numeric","align":"center"},{"accessor":"V6","name":"Control","type":"numeric","align":"center","style":{"borderRight":"1px solid rgba(0, 0, 0, 0.1)"}},{"accessor":"V7","name":"Treat","type":"numeric","align":"center"},{"accessor":"V8","name":"Control","type":"numeric","align":"center"}],"columnGroups":[{"name":"Non-competitive","columns":["V1","V2"]},{"name":"Competitive","columns":["V3","V4"]},{"name":"Non-competitive","columns":["V5","V6"]},{"name":"Competitive","columns":["V7","V8"]},{"name":"State 1","columns":["V1","V2","V3","V4"]}],"defaultPageSize":10,"paginationType":"numbers","showPageInfo":true,"minRows":1,"highlight":true,"striped":true,"style":{"fontFamily":"Fira Sans, sans-serif"},"dataKey":"56afef48ecc2085445d004f19021e523","key":"56afef48ecc2085445d004f19021e523"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
]

---
# Estimating the effect

- Depending on the design, usually you can **.darkorange[compare group means]** or fit a **.darkorange[simple regression]**

--

`$$\frac{1}{N_T}\sum_{i\in T}Y_i - \frac{1}{N_C}\sum_{i\in C}Y_i$$`

`$$Y_i = \beta_0 + \beta_1 Z_i + \varepsilon_i$$`

--

.box-4[How do we incorporate stratification here?]

---
# Estimating the effect

- In stratified RCTs, we need to consider the strata!

--

- Run a regression with *fixed effects by strata*

.box-6[$$Y_i = \beta_0 + \beta_1 Z_i + \gamma_s + \varepsilon_i$$]


---
# Estimating the effect


.small[

```r
library(estimatr)

d_s1 &lt;- d_s1 %&gt;% mutate(strata = interaction(state, competiv))

summary(lm_robust(vote02 ~ treat_real + strata, data = d_s1))
```

```
## 
## Call:
## lm_robust(formula = vote02 ~ treat_real + strata, data = d_s1)
## 
## Standard error type:  HC2 
## 
## Coefficients:
##             Estimate Std. Error t value  Pr(&gt;|t|)  CI Lower CI Upper     DF
## (Intercept) 0.486984  0.0008837 551.048 0.000e+00  0.485252 0.488716 733335
## treat_real  0.000369  0.0027329   0.135 8.926e-01 -0.004987 0.005725 733335
## strata1.1   0.108725  0.0018181  59.800 0.000e+00  0.105161 0.112288 733335
## strata0.2   0.044896  0.0057059   7.868 3.602e-15  0.033712 0.056079 733335
## strata1.2   0.169422  0.0012373 136.931 0.000e+00  0.166997 0.171848 733335
## 
## Multiple R-squared:  0.02537 ,	Adjusted R-squared:  0.02536 
## F-statistic:  4777 on 4 and 733335 DF,  p-value: &lt; 2.2e-16
```
]

---
# Estimating the effect

- One important thing to note in the previous analysis is that **.darkorange[assignment to treatment]** `\(\neq\)` **.darkorange[contact]**


```r
d_s1 %&gt;% count(treat_real, contact)
```

```
##   treat_real contact      n
## 1          0       0 698815
## 2          1       0  19210
## 3          1       1  15315
```

--

.box-5[Does this affect the internal validity of the study?]

---
background-position: 50% 50%
class: left, bottom, inverse
.big[
When we assume...
]

---
# Other assumptions

.pull-left[
- We already talked about the **.darkorange[ignorability assumption]**


- **.darkorange[Stable Unit Treatment Value Assumption (SUTVA)]**:

  - No interference
  - No hidden variations of treatments
]

.pull-right[
.center[
![](https://media.giphy.com/media/xT5LMHsI58Q1ZpugPC/giphy.gif)]
]
---
# SUTVA: No interference

- *"The treatment applied to one unit does not affect the outcome for other units"*

--

- Imagine we have two individuals, 1 and 2:

  - `\(Z_1\)` and `\(Z_2\)` will be the treatment assignment for 1 and 2, respectively.
  
  - Under SUTVA:
  
  .box-3LA[$$(Y_2(0), Y_2(1)) \perp Z_1$$]
  

---
# SUTVA: No hidden variations of treatments

- *"An individual receiving an specific treatment level cannot receive different forms of that treatment."*

--

- Think about the headache example from last class:

  - Individual 1 gets a **.darkorange[new aspirin (aspirin +)]**
  - Individual 2 gets an **.darkorange[old aspirin (aspirin -)]**
  - Individual 3 doesn't get a pill
  
- If we label the treatments as `\(Z=0\)` (doesn't get an aspirin) and `\(Z=1\)` (gets an aspirin), **.darkorange[potential outcomes would change depending on whether they got *aspirin +* or *aspirin -*.]**



---
# When SUTVA hits the fan

.center2[
.box-7[When do you think SUTVA could fail?]
]
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
.bottom2[.lightgrey[h/t to @paul_gp]]

---
# When SUTVA hits the fan
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
.center[
.box-3[Network effects]
]
--
.center[
.box-5[General Equilibrium Effects]
]

---
# Network effects

- Also referred to as **.darkorange[spillovers]**

- Potential outcomes will depend on *who gets the treatment*

&lt;br&gt;
&lt;br&gt;
.box-2LA[Let's look at an example]

---
# Network effects

.center[
![:scale 80%](https://raw.githubusercontent.com/maibennett/sta235/main/exampleSite/content/Classes/Week5/1_RCT/images/networks1.png)
]


---
# Network effects

.center[
![:scale 80%](https://raw.githubusercontent.com/maibennett/sta235/main/exampleSite/content/Classes/Week5/1_RCT/images/networks2.png)
]

---
# Network effects

.center[
![:scale 80%](https://raw.githubusercontent.com/maibennett/sta235/main/exampleSite/content/Classes/Week5/1_RCT/images/networks3.png)
]

---
# Network effects

.center[
![:scale 80%](https://raw.githubusercontent.com/maibennett/sta235/main/exampleSite/content/Classes/Week5/1_RCT/images/networks4.png)
]

---
# Network effects

.center[
![:scale 80%](https://raw.githubusercontent.com/maibennett/sta235/main/exampleSite/content/Classes/Week5/1_RCT/images/networks5.png)
]

---
# Network effects

.box-6LA[Can we do something about this?]
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
--

1. **.darkorange[Randomize at a higher level]** (e.g. neighborhood, school, etc. instead of at the individual level)

--

  - Note that you will have to **.darkorange[cluster your standard errors]**

--

2. **.darkorange[Model the network!]**

---
# General Equilibrium Effects

- Usually arise when you **.darkorange[scale up]** a program or intervention.

- Imagine you want to test the effect of providing information about employment and expected income to students to see whether it affect their choice of university and/or major.

--
&lt;br&gt;
&lt;br&gt;
.box-7LA[What could happen if you offer it to everyone?]

---
background-position: 50% 50%
class: left, bottom, inverse
.big[
Show me the power
]

---
# Statistical power

- **.darkorange[Statistical power]** refers to the probability that a test correctly rejects the null hypothesis `\(H_0\)`, when `\(H_0\)` is false.

  - It's related to sample size!

--

.box-6[Power = 1- Pr(Type II error)]

- **.darkorange[Type I error]**: Probability of rejecting the null hypothesis, when the null is true ($\alpha$).

- **.darkorange[Type II error]**: Probability of not rejecting the null hypothesis, when the null is false ($\beta$).

---
# Statistical power

- **.darkorange[Statistical power]** refers to the probability that a test correctly rejects the null hypothesis `\(H_0\)`, when `\(H_0\)` is false.

  - It's related to sample size!


.box-6[Power = 1- Pr(Type II error)]

- **.darkorange[False Positive]**: Probability of rejecting the null hypothesis, when the null is true ($\alpha$).

- **.darkorange[False Negative]**: Probability of not rejecting the null hypothesis, when the null is false ($\beta$).

---
# Statistical power


.center[
![:scale 70%](https://raw.githubusercontent.com/maibennett/sta235/main/exampleSite/content/Classes/Week5/1_RCT/images/type_1_errors.png)]


---
# Statistical power


.center[
![:scale 90%](https://raw.githubusercontent.com/maibennett/sta235/main/exampleSite/content/Classes/Week5/1_RCT/images/type_2_errors.png)]

---
#Statistical power and sample size
.box-2t[How big of a sample?]

--




.box-4t[A training program causes incomes to rise by $40]

.center.small[
&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; Person &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Group &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; Before &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; After &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; Difference &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 295 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Control &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 122.09 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 219.04 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 96.95 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 126 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Treatment &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 205.60 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 199.84 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; -5.76 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 400 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Control &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 133.25 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 120.40 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; -12.85 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 94 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Treatment &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 270.11 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 206.56 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; -63.54 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 250 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Control &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 344.37 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 212.89 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; -131.49 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 59 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Treatment &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 312.41 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 268.06 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; -44.35 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
]

---
# Can I detect an effect?

.pull-left[
.center[
.box-5b[Enroll 10 participants]]

&lt;img src="f2021_sta235h_8_RCT_files/figure-html/power-small-1.png" width="100%" /&gt;

]

--

.pull-right[
.center[.box-5b[Enroll 200 participants]]

&lt;img src="f2021_sta235h_8_RCT_files/figure-html/power-big-1.png" width="100%" /&gt;

]


---
# What's the right sample size?

.box-6[Use a statistical power calculator to&lt;br&gt;make sure you can potentially detect an effect]

.center[
![:scale 50%](https://raw.githubusercontent.com/maibennett/sta235/main/exampleSite/content/Classes/Week5/1_RCT/images/power-search.png)
]

--

.box-7[Or you can use simulations!]

---
background-position: 50% 50%
class: left, bottom, inverse
.big[
Limitations and Potential Problems in Randomized Controlled Trials
]

---
# Generalizibility of RCTs

- External Validity vs Internal Validity:

  - **.darkorange[External validity]**: "The extent to which results can be generalized to other contexts or populations."
  
  - **.darkorange[Internal validity]**: "[T]he extent to which the observed results represent the truth in the population we are studying."

---
# External vs Internal Validity

.center[
![:scale 75%](https://raw.githubusercontent.com/maibennett/sta235/main/exampleSite/content/Classes/Week5/1_RCT/images/validity.png)]

--
- Many times, RCTs use **.darkorange[convenience samples]**

---
# Noncompliance and Attrition

.box-5[Attrition]

.box-5t[Units fall out of your sample]

- **.darkorange[Can you give an example?]**

---
# Noncompliance and Attrition

.box-5[Attrition]

.box-5t[Units fall out of your sample]

.box-7[Noncompliance]

.box-7t[Units that where assigned to one group end up in another]

- **.darkorange[Example?]**

---
# Noncompliance and Attrition

- If **.darkorange[attrition]** is correlated with the treatment, we're in trouble.

--

.box-3LA[WHY?]

---
# Noncompliance and Attrition

- If **.darkorange[attrition]** is correlated with the treatment, we're in trouble.


.box-3LA[The ignorability assumption can break!]

---
# Noncompliance and Attrition

- If **.darkorange[attrition]** is correlated with the treatment, we're in trouble.

.box-3LA[The ignorability assumption can break!]

- **.darkorange[Noncompliance]** is a problem for identifying `\(ATE\)`.

  - E.g. Treatment *assingment* is random, but not necessarily the *take-up* of the treatment
  
--
  
  - Stuck with **.darkorange[Intention to Treat (ITT) effect]**.

---
# Other problems to look out for

1. **.darkorange[Hawthorne effects]**:

  - Effect that occurs when people behave differently because they are being watched

--

2. **.darkorange[John Henry effects]**:

  - Effect that occurs when the control group works harder because they were not assigned to treatment.


---
# Feasibility

.pull-left[
- RCTs can be **.darkorange[expensive]** and also **.darkorange[slow]**.

- Organizations might **.darkorange[not be willing to randomize]**.
]

.pull-right[
.center[
![:scale 90%](https://media.giphy.com/media/1xkMJIvxeKiDS/giphy.gif)]
]
---
# Getting around some issues

- **.darkorange[Staggered adoption]**: Eventually treat everyone, but at different times.

  - You can think about this when you have panel data.

- **.darkorange[Randomize in the bubble]**:

  - Not randomize everyone, but maybe those that are on the margin of receiving the treatment.
  
---
background-position: 50% 50%
class: left, bottom, inverse
.big[
A/B Testing
]

---
# A/B Testing

.pull-left[
.center[
![](https://media.giphy.com/media/LmNwrBhejkK9EFP504/giphy.gif)]
]

.pull-right[
- A/B testing is very popular right now to test the effect of **.darkorange[small changes]** in products on an outcome of interest.

- E.g. In web development, user would be exposed to **.darkorange[different versions of the same website]** (only with subtle changes).

- Companies can quickly analyze the data, adapt their design, and continue testing features.
]

---
# A/B Testing Jargon

- There's a lot of jargon in A/B testing that is thrown out there...

.box-7[What does it all mean?]

--

.box-5t[Conversions]

.box-4t[Regret]

.box-2t[Multi-armed bandits/ Contextual bandits]

---
# A/B Testing Jargon

- **.darkorange[Conversions]**: "Cause the customer to take action"

- **.darkorange[Regret]**: Loss of conversion due to a low-performing treatment.
--

&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
.box-7[Maximize conversions and minimize regret]

---
# A/B Testing Jargon

- **.darkorange[Multi-armed bandits/ Contextual bandits]**

  - Name comes from machines at casinos.
  - You want to maximize total payout `\(\rightarrow\)` Balance between exploration and exploitation

.center[
![:scale 50%](https://raw.githubusercontent.com/maibennett/sta235/main/exampleSite/content/Classes/Week5/1_RCT/images/slot-machine.png)]
--

- **.darkorange[Multi-armed bandits]** redirect users to the more successful versions of the treatment.

- A **.darkorange[contextual bandit]** uses prior information from the user to select an action.

---
# A/B Testing in Data: MSU Library

- Montana University Library website: Low interaction with the "Interact" Category
.center[
![:scale 50%](https://raw.githubusercontent.com/maibennett/sta235/main/exampleSite/content/Classes/Week5/1_RCT/images/montana_control.png)]
---
# A/B Testing in Data: MSU Library
.center[
![:scale 50%](https://raw.githubusercontent.com/maibennett/sta235/main/exampleSite/content/Classes/Week5/1_RCT/images/heatmap_control.png)]

---
# A/B Testing in Data: Different treatments

- Test four different names for that category

.pull-left[
.center[
![:scale 80%](https://raw.githubusercontent.com/maibennett/sta235/main/exampleSite/content/Classes/Week5/1_RCT/images/connect.png)

![:scale 80%](https://raw.githubusercontent.com/maibennett/sta235/main/exampleSite/content/Classes/Week5/1_RCT/images/learn.png)]
]

.pull-right[
.center[
![:scale 80%](https://raw.githubusercontent.com/maibennett/sta235/main/exampleSite/content/Classes/Week5/1_RCT/images/help.png)

![:scale 80%](https://raw.githubusercontent.com/maibennett/sta235/main/exampleSite/content/Classes/Week5/1_RCT/images/services.png)]
]

---
# A/B Testing in Data: Analyze results

.center2[
.box-5LA[How would you analyze these results?]]

---
.center[
![:scale 100%](https://raw.githubusercontent.com/maibennett/sta235/main/exampleSite/content/Classes/Week5/1_RCT/images/google_analytics1.png)]
---
.center[
![:scale 100%](https://raw.githubusercontent.com/maibennett/sta235/main/exampleSite/content/Classes/Week5/1_RCT/images/google_analytics2.png)]
---
# Homepage click-through
.center[
![:scale 60%](https://raw.githubusercontent.com/maibennett/sta235/main/exampleSite/content/Classes/Week5/1_RCT/images/click_through.png)]
---
# Drop-off
.center[
![:scale 55%](https://raw.githubusercontent.com/maibennett/sta235/main/exampleSite/content/Classes/Week5/1_RCT/images/drop_off.png)]
---
# Homepage return
.center[
![:scale 55%](https://raw.githubusercontent.com/maibennett/sta235/main/exampleSite/content/Classes/Week5/1_RCT/images/homepage_return.png)]

---
# Wrapping things up

- Randomized controlled trials are great... **.darkorange[but not for everything!]**

--

- Randomization buys us **.darkorange[no systematic selection on observables or unobservables]**

  - But things can go wrong, too!
  
--

.box-6LA[Check your assumptions and look out for potential issues!]

&lt;!-- pagedown::chrome_print('C:/Users/mc72574/Dropbox/Hugo/Sites/sta235/exampleSite/content/Classes/Week5/1_RCT/f2021_sta235h_8_RCT.html') --&gt;
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="macros.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false,
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
