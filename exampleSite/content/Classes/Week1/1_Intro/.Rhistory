geom_boxplot(position = "dodge") +
geom_smooth(aes(group = factor(z))) +
scale_color_manual(values=c("#F89441","#900DA4")) +
scale_fill_manual(values=c(alpha("#F89441",0.3),alpha("#900DA4",0.3))) +
theme_bw()+
theme_ipsum_fsc(plot_title_face = "bold") + #plain
xlab("Time") + ylab("Outcome")+ ggtitle("Not matched") +
theme(plot.margin=unit(c(1,1,1.5,1.2),"cm"),
panel.grid.major.x = element_blank(),
panel.grid.minor.x = element_blank(),
panel.grid.major.y = element_blank(),
panel.grid.minor.y = element_blank(),
axis.line = element_line(colour = "dark grey"),legend.position="none")+
theme(axis.title.x = element_text(size=16),#margin = margin(t = 10, r = 0, b = 0, l = 0)),
axis.text.x = element_text(size=10,angle = 0,hjust=0.5,vjust=1,margin=margin(0.1,0,0,0)),
axis.title.y = element_text(size=16),#margin = margin(t = 0, r = 10, b = 0, l = 0)),
axis.text.y = element_text(size=10),legend.position="none",
title = element_text(size=14)) +
theme(plot.margin = unit(c(0,1,0,1), "cm"))
### Matching
d_wide = d %>% pivot_wider(id_cols = id, names_from = t, values_from = y, names_prefix = "y")
d_wide$z = 0
d_wide$z[d_wide$id %in% unique(d$id[d$z==1])] = 1
match.1 = matchit(z ~ `y-3` + `y-2` + `y-1` + `y0`, data = d_wide, method = "nearest", discard = "both", caliper = 0.3)
d_m <- match.data(match.1)
table(d_m$z)
dm = pivot_longer(d_m, cols = starts_with("y"), names_to = "y")
dm$t = NA
dm$t[dm$y=="y-3"] = -3
dm$t[dm$y=="y-2"] = -2
dm$t[dm$y=="y-1"] = -1
dm$t[dm$y=="y0"] = -0
dm$t[dm$y=="y1"] = 1
dm$t[dm$y=="y2"] = 2
dm$t[dm$y=="y3"] = 3
dm$y = dm$value
g2 = ggplot(data = dm, aes(x = factor(t), y = y, fill=factor(z), color=factor(z))) +
geom_vline(xintercept = "0", lty=2) +
geom_boxplot(position = "dodge") +
geom_smooth(aes(group = factor(z))) +
scale_color_manual(values=c("#F89441","#900DA4")) +
scale_fill_manual(values=c(alpha("#F89441",0.3),alpha("#900DA4",0.3))) +
theme_bw()+
theme_ipsum_fsc(plot_title_face = "bold") + #plain
xlab("Time") + ylab("Outcome")+ ggtitle("Matched") +
theme(plot.margin=unit(c(1,1,1.5,1.2),"cm"),
panel.grid.major.x = element_blank(),
panel.grid.minor.x = element_blank(),
panel.grid.major.y = element_blank(),
panel.grid.minor.y = element_blank(),
axis.line = element_line(colour = "dark grey"),legend.position="none")+
theme(axis.title.x = element_text(size=16),#margin = margin(t = 10, r = 0, b = 0, l = 0)),
axis.text.x = element_text(size=10,angle = 0,hjust=0.5,vjust=1,margin=margin(0.1,0,0,0)),
axis.title.y = element_text(size=16),#margin = margin(t = 0, r = 10, b = 0, l = 0)),
axis.text.y = element_text(size=10),legend.position="none",
title = element_text(size=14)) +
theme(plot.margin = unit(c(0,1,0,1), "cm"))
grid.arrange(g1,g2)
install.packages("causaldata")
2*60+35
2*60+25
pagedown::chrome_print('C:/Users/mc72574/Dropbox/Hugo/Sites/sta235/exampleSite/content/Classes/Week1/1_Intro/f2021_sta235h_1_intro.html')
install.packages("ghibli")
98/(42*3 + 39)
20/(42*3 + 39)
library(ggplot2)
library(firasans)
library(hrbrthemes)
library(extrafont)
library("RColorBrewer")
library(viridis)
library("tm")
library("SnowballC")
library("wordcloud")
library("RColorBrewer")
library("firasans")
library(hrbrthemes)
library(extrafont)
library(ghibli)
text <- readLines("https://raw.githubusercontent.com/maibennett/sta235/main/exampleSite/content/Classes/Week1/1_Intro/data/STA%20235H%20-%20Intro%20Survey_wordcloud.csv")
docs <- Corpus(VectorSource(text))
toSpace <- content_transformer(function (x , pattern ) gsub(pattern, " ", x))
docs <- tm_map(docs, toSpace, "/")
docs <- tm_map(docs, toSpace, "@")
docs <- tm_map(docs, toSpace, "\\|")
# Convert the text to lower case
docs <- tm_map(docs, content_transformer(tolower))
# Remove numbers
docs <- tm_map(docs, removeNumbers)
# Remove english common stopwords
docs <- tm_map(docs, removeWords, stopwords("english"))
# Remove your own stop word
# specify your stopwords as a character vector
docs <- tm_map(docs, removeWords, c("blabla1", "blabla2"))
# Remove punctuations
docs <- tm_map(docs, removePunctuation)
# Eliminate extra white spaces
docs <- tm_map(docs, stripWhitespace)
# Text stemming
# docs <- tm_map(docs, stemDocument)
dtm <- TermDocumentMatrix(docs,list(wordLengths=c(1,Inf)))
dtm$dimnames$Terms
m <- as.matrix(dtm)
v <- sort(rowSums(m),decreasing=TRUE)
d <- data.frame(word = names(v),freq=v)
#head(d, 10)
d$word[d$word=="r"] = "R"
dtm <- TermDocumentMatrix(docs,list(wordLengths=c(1,Inf)))
m <- as.matrix(dtm)
v <- sort(rowSums(m),decreasing=TRUE)
d <- data.frame(word = names(v),freq=v)
View(d)
?data.frame
dtm <- TermDocumentMatrix(docs,list(wordLengths=c(1,Inf)))
m <- as.matrix(dtm)
v <- sort(rowSums(m),decreasing=TRUE)
d <- data.frame(word = names(v),freq=v, stringsAsFactors = FALSE)
#head(d, 10)
d$word[d$word=="r"] = "R"
set.seed(1234)
#wordcloud(words = d$word, freq = d$freq, min.freq = 1,
#          max.words=200, random.order=FALSE, rot.per=0.35,
#          colors=brewer.pal(5, "Dark2"), family = "Fira Sans Condensed SemiBold")
wordcloud(words = d$word, freq = d$freq, min.freq = 1,
max.words=200, random.order=FALSE, rot.per=0.35,
colors=ghibli_palettes$PonyoMedium[c(2,3,4,6)], family = "Fira Sans Condensed SemiBold")
text <- readLines("https://raw.githubusercontent.com/maibennett/sta235/main/exampleSite/content/Classes/Week1/1_Intro/data/STA%20235H%20-%20Intro%20Survey_wordcloud.csv")
docs <- Corpus(VectorSource(text))
toSpace <- content_transformer(function (x , pattern ) gsub(pattern, " ", x))
docs <- tm_map(docs, toSpace, "/")
docs <- tm_map(docs, toSpace, "@")
docs <- tm_map(docs, toSpace, "\\|")
# Convert the text to lower case
docs <- tm_map(docs, content_transformer(tolower))
# Remove numbers
docs <- tm_map(docs, removeNumbers)
# Remove english common stopwords
docs <- tm_map(docs, removeWords, stopwords("english"))
# Remove your own stop word
# specify your stopwords as a character vector
docs <- tm_map(docs, removeWords, c("blabla1", "blabla2","yet"))
# Remove punctuations
docs <- tm_map(docs, removePunctuation)
# Eliminate extra white spaces
docs <- tm_map(docs, stripWhitespace)
# Text stemming
# docs <- tm_map(docs, stemDocument)
dtm <- TermDocumentMatrix(docs,list(wordLengths=c(1,Inf)))
m <- as.matrix(dtm)
v <- sort(rowSums(m),decreasing=TRUE)
d <- data.frame(word = names(v),freq=v, stringsAsFactors = FALSE)
#head(d, 10)
d$word[d$word=="r"] = "R"
set.seed(1234)
#wordcloud(words = d$word, freq = d$freq, min.freq = 1,
#          max.words=200, random.order=FALSE, rot.per=0.35,
#          colors=brewer.pal(5, "Dark2"), family = "Fira Sans Condensed SemiBold")
wordcloud(words = d$word, freq = d$freq, min.freq = 1,
max.words=200, random.order=FALSE, rot.per=0.35,
colors=ghibli_palettes$PonyoMedium[c(2,3,4,6)], family = "Fira Sans Condensed SemiBold")
ghibli_palettes$PonyoMedium
ghibli_palettes$PonyoMedium[c(2,3,4,6)]
wordcloud(words = d$word, freq = d$freq, min.freq = 1,
max.words=200, random.order=FALSE, rot.per=0.35,
colors=c("#118ab2","#06d6a0","#ffd166","#ef476f"), family = "Fira Sans Condensed SemiBold")
wordcloud(words = d$word, freq = d$freq, min.freq = 1,
max.words=200, random.order=FALSE, rot.per=0.35,
colors=c("#118ab2","#06d6a0","#ffd166","#ef476f"), family = "Fira Sans Condensed")
wordcloud(words = d$word, freq = d$freq, min.freq = 1,
max.words=200, random.order=FALSE, rot.per=0.35,
colors=c("#118ab2","#06d6a0","#ffd166","#ef476f"), family = "Fira Sans")
d <- read.csv("https://raw.githubusercontent.com/maibennett/sta235/main/exampleSite/content/Classes/Week1/1_Intro/data/STA%20235H%20-%20Intro%20Survey.csv")
library(tidyverse)
d <- read.csv("https://raw.githubusercontent.com/maibennett/sta235/main/exampleSite/content/Classes/Week1/1_Intro/data/STA%20235H%20-%20Intro%20Survey.csv")
d <- d %>% filter(!is.na(How.comfortable.are.you.with.coding.in.R.))
ggplot(data = d, aes(x = factor(How.comfortable.are.you.with.coding.in.R.,
levels = seq(1,10,1)))) +
geom_bar(color="#900DA4", fill = alpha("#900DA4",0.5), lwd=1.5) +
scale_x_discrete(labels = c("1" = "1\nVery\nuncomfortable","2" = "2","3" = "3","4" = "4","5" = "5","6" = "6",
"7" = "7","8" = "8","9" = "9","10" = "10\nSuper\ncomfortable"), drop = FALSE) +
theme_bw()+
theme_ipsum_fsc(plot_title_face = "bold",plot_title_size = 24) + #plain
xlab("") + ylab("Count")+#ggtitle("How comfortable are you with R?")+
theme(plot.margin=unit(c(1,1,1.5,1.2),"cm"),
panel.grid.major.x = element_blank(),
panel.grid.minor.x = element_blank(),
panel.grid.major.y = element_blank(),
panel.grid.minor.y = element_blank(),
axis.line = element_line(colour = "dark grey"))+
theme(axis.title.x = element_blank(),#margin = margin(t = 10, r = 0, b = 0, l = 0)),
axis.text.x = element_text(size=14),
axis.title.y = element_text(size=18),#margin = margin(t = 0, r = 10, b = 0, l = 0)),
axis.text.y = element_text(size=14),legend.position="none",
legend.title = element_blank(),
legend.text = element_text(size=15),
legend.background = element_rect(fill="white",colour ="white"),
title = element_text(size=14))
d <- read.csv("https://raw.githubusercontent.com/maibennett/sta235/main/exampleSite/content/Classes/Week1/1_Intro/data/STA%20235H%20-%20Intro%20Survey.csv")
d <- d %>% filter(!is.na(Thinking.forward.to.the.end.of.the.semester..what.grade.do.you.think.you.will.get.in.this.course.))
d$grades = factor(d$Thinking.forward.to.the.end.of.the.semester..what.grade.do.you.think.you.will.get.in.this.course.,
levels = c("A","A-","B+","B","B-","C+","C","C-","D","F"))
d2 = as.data.frame(cbind(table(d$grades),rownames(table(d$grades))))
names(d2) = c("value","Grades")
d2$Grades = factor(d2$Grades, levels = c("A","A-","B+","B","B-","C+","C","C-","D","F"))
cols = c("#0D0887","#5601A4","#900DA4","#BF3984","#900DA4","#E16462","#F89441","#f5c542","#FCCE25","#f5dc7f")
ggplot(data = d2, aes(x="",y=as.numeric(value),fill=Grades)) +
geom_bar(lwd=1.5, stat="identity", color="white") +
coord_polar("y",start = 0)+
scale_fill_manual(values=cols) +
#scale_x_discrete(name="x", breaks=seq(1,10,1), labels = c("1\nVery uncomfortable","2","3","4","5","6","7","8","9","10\nSuper comfortable"), limits = c(1,2,3,4,5,6,7,8,9,10)) +
theme_void()+
theme_ipsum_fsc(plot_title_face = "bold",plot_title_size = 24) + #plain
#ggtitle("How comfortable are you with R?")+
#ylim(0,5)+
theme(plot.margin=unit(c(1,1,1.5,1.2),"cm"),
panel.grid.major.x = element_blank(),
panel.grid.minor.x = element_blank(),
panel.grid.major.y = element_blank(),
panel.grid.minor.y = element_blank(),
axis.line = element_blank())+
theme(axis.title.x = element_blank(),#margin = margin(t = 10, r = 0, b = 0, l = 0)),
axis.text.x = element_blank(),
axis.title.y = element_blank(),#margin = margin(t = 0, r = 10, b = 0, l = 0)),
axis.text.y = element_blank(),legend.position="right",
legend.title = element_text(size=15),
legend.text = element_text(size=12),
legend.background = element_rect(fill="white",colour ="white"),
title = element_text(size=14))
d <- read.csv("https://raw.githubusercontent.com/maibennett/sta235/main/exampleSite/content/Classes/Week1/1_Intro/data/STA%20235H%20-%20Intro%20Survey.csv",
stringsAsFactors = FALSE)
d <- d %>% filter(!is.na(Thinking.forward.to.the.end.of.the.semester..what.grade.do.you.think.you.will.get.in.this.course.))
d <- d %>% filter(Thinking.forward.to.the.end.of.the.semester..what.grade.do.you.think.you.will.get.in.this.course.!="")
d <- read.csv("https://raw.githubusercontent.com/maibennett/sta235/main/exampleSite/content/Classes/Week1/1_Intro/data/STA%20235H%20-%20Intro%20Survey.csv",
stringsAsFactors = FALSE)
d <- d %>% filter(!is.na(How.comfortable.are.you.with.coding.in.R.))
d <- read.csv("https://raw.githubusercontent.com/maibennett/sta235/main/exampleSite/content/Classes/Week1/1_Intro/data/STA%20235H%20-%20Intro%20Survey.csv",
stringsAsFactors = FALSE)
d <- d %>% filter(Thinking.forward.to.the.end.of.the.semester..what.grade.do.you.think.you.will.get.in.this.course.!="")
d$grades = factor(d$Thinking.forward.to.the.end.of.the.semester..what.grade.do.you.think.you.will.get.in.this.course.,
levels = c("A","A-","B+","B","B-","C+","C","C-","D","F"))
d2 = as.data.frame(cbind(table(d$grades),rownames(table(d$grades))))
names(d2) = c("value","Grades")
d2$Grades = factor(d2$Grades, levels = c("A","A-","B+","B","B-","C+","C","C-","D","F"))
cols = c("#0D0887","#5601A4","#900DA4","#BF3984","#900DA4","#E16462","#F89441","#f5c542","#FCCE25","#f5dc7f")
ggplot(data = d2, aes(x="",y=as.numeric(value),fill=Grades)) +
geom_bar(lwd=1.5, stat="identity", color="white") +
coord_polar("y",start = 0)+
scale_fill_manual(values=cols) +
#scale_x_discrete(name="x", breaks=seq(1,10,1), labels = c("1\nVery uncomfortable","2","3","4","5","6","7","8","9","10\nSuper comfortable"), limits = c(1,2,3,4,5,6,7,8,9,10)) +
theme_void()+
theme_ipsum_fsc(plot_title_face = "bold",plot_title_size = 24) + #plain
#ggtitle("How comfortable are you with R?")+
#ylim(0,5)+
theme(plot.margin=unit(c(1,1,1.5,1.2),"cm"),
panel.grid.major.x = element_blank(),
panel.grid.minor.x = element_blank(),
panel.grid.major.y = element_blank(),
panel.grid.minor.y = element_blank(),
axis.line = element_blank())+
theme(axis.title.x = element_blank(),#margin = margin(t = 10, r = 0, b = 0, l = 0)),
axis.text.x = element_blank(),
axis.title.y = element_blank(),#margin = margin(t = 0, r = 10, b = 0, l = 0)),
axis.text.y = element_blank(),legend.position="right",
legend.title = element_text(size=15),
legend.text = element_text(size=12),
legend.background = element_rect(fill="white",colour ="white"),
title = element_text(size=14))
d <- read.csv("https://raw.githubusercontent.com/maibennett/sta235/main/exampleSite/content/Classes/Week1/1_Intro/data/STA%20235H%20-%20Intro%20Survey.csv",
stringsAsFactors = FALSE)
d <- d %>% filter(Thinking.forward.to.the.end.of.the.semester..what.grade.do.you.think.you.will.get.in.this.course.!="")
d$grades = factor(d$Thinking.forward.to.the.end.of.the.semester..what.grade.do.you.think.you.will.get.in.this.course.,
levels = c("A","A-","B+","B","B-","C+","C","C-","D","F"))
d2 = as.data.frame(cbind(table(d$grades),rownames(table(d$grades))))
names(d2) = c("value","Grades")
d2
d2 = as.data.frame(cbind(table(d$grades),rownames(table(d$grades))))
names(d2) = c("value","Grades")
d2$Grades = factor(d2$Grades, levels = c("A","A-","B+","B","B-","C+","C","C-","D","F"))
cols = c("#0D0887","#5601A4","#900DA4","#BF3984","#900DA4","#E16462","#F89441","#f5c542","#FCCE25","#f5dc7f")
ggplot(data = d2, aes(x="",y=as.numeric(value),fill=Grades)) +
geom_bar(lwd=1.5, stat="identity", color="white") +
coord_polar("y",start = 0)+
scale_fill_manual(values=cols)
as.numeric(d2$value)
d2
d2 = as.data.frame(cbind(table(d$grades),rownames(table(d$grades))), stringsAsFactors = FALSE)
names(d2) = c("value","Grades")
d2$Grades = factor(d2$Grades, levels = c("A","A-","B+","B","B-","C+","C","C-","D","F"))
cols = c("#0D0887","#5601A4","#900DA4","#BF3984","#900DA4","#E16462","#F89441","#f5c542","#FCCE25","#f5dc7f")
ggplot(data = d2, aes(x="",y=as.numeric(value),fill=Grades)) +
geom_bar(lwd=1.5, stat="identity", color="white") +
coord_polar("y",start = 0)+
scale_fill_manual(values=cols) +
#scale_x_discrete(name="x", breaks=seq(1,10,1), labels = c("1\nVery uncomfortable","2","3","4","5","6","7","8","9","10\nSuper comfortable"), limits = c(1,2,3,4,5,6,7,8,9,10)) +
theme_void()+
theme_ipsum_fsc(plot_title_face = "bold",plot_title_size = 24) + #plain
#ggtitle("How comfortable are you with R?")+
#ylim(0,5)+
theme(plot.margin=unit(c(1,1,1.5,1.2),"cm"),
panel.grid.major.x = element_blank(),
panel.grid.minor.x = element_blank(),
panel.grid.major.y = element_blank(),
panel.grid.minor.y = element_blank(),
axis.line = element_blank())+
theme(axis.title.x = element_blank(),#margin = margin(t = 10, r = 0, b = 0, l = 0)),
axis.text.x = element_blank(),
axis.title.y = element_blank(),#margin = margin(t = 0, r = 10, b = 0, l = 0)),
axis.text.y = element_blank(),legend.position="right",
legend.title = element_text(size=15),
legend.text = element_text(size=12),
legend.background = element_rect(fill="white",colour ="white"),
title = element_text(size=14))
pagedown::chrome_print('C:/Users/mc72574/Dropbox/Hugo/Sites/sta235/exampleSite/content/Classes/Week1/1_Intro/f2021_sta235h_1_intro.html')
library(ggplot2)
d <- read.delim("C:/Users/mc72574/Dropbox/UT/Teaching/2021Fall_STA235H/data/2019_SFNationalFileA2019/fhlmc_sf2019a_loans.txt", sep = " ")
d1 <- read.delim("C:/Users/mc72574/Dropbox/UT/Teaching/2021Fall_STA235H/data/2019_SFNationalFileA2019/fnma_sf2019a_loans.txt", sep = " ")
d2 <- read.delim("C:/Users/mc72574/Dropbox/UT/Teaching/2021Fall_STA235H/data/2019_SFNationalFileA2019/fhlmc_sf2019a_loans.txt", sep = " ")
# Clears memory
rm(list = ls())
# Clears console
cat("\014")
library(ggplot2)
d1 <- read.delim("C:/Users/mc72574/Dropbox/UT/Teaching/2021Fall_STA235H/data/2019_SFNationalFileA2019/fnma_sf2019a_loans.txt", sep = " ")
d2 <- read.delim("C:/Users/mc72574/Dropbox/UT/Teaching/2021Fall_STA235H/data/2019_SFNationalFileA2019/fhlmc_sf2019a_loans.txt", sep = " ")
library(tidyverse)
d <- d1 %>% add_row(d2)
names <- c("Enterprise.Flag","Record.Number","MSA.Code","CT.Per.Min","Tract.Inc.Ratio","Borrower.Inc.Ratio",
"LoanToValue.Ratio","Purpose.Loan","Federal.Guarantee","Borrower.Race","CoBorrower.Race","Borrower.Gender",
"CoBorrower.Gender","Num.Units","Unit.Affordability","")
names(d) <- names
names(d1) <- names
names(d1) <- names
names(d2) <- names
d1 <- d1[,-c(2:7)]
d2 <- d2[,-c(2:7)]
names <- c("Enterprise.Flag","Record.Number","MSA.Code","CT.Per.Min","Tract.Inc.Ratio","Borrower.Inc.Ratio",
"LoanToValue.Ratio","Purpose.Loan","Federal.Guarantee","Borrower.Race","CoBorrower.Race","Borrower.Gender",
"CoBorrower.Gender","Num.Units","Unit.Affordability","")
names(d1) <- names
names(d2) <- names
# Clears memory
rm(list = ls())
# Clears console
cat("\014")
library(tidyverse)
library(ggplot2)
# Fanny Mae
d1 <- read.delim("C:/Users/mc72574/Dropbox/UT/Teaching/2021Fall_STA235H/data/2019_SFNationalFileA2019/fnma_sf2019a_loans.txt", sep = " ")
# Freddy Mac
d2 <- read.delim("C:/Users/mc72574/Dropbox/UT/Teaching/2021Fall_STA235H/data/2019_SFNationalFileA2019/fhlmc_sf2019a_loans.txt", sep = " ")
d1 <- d1[,-c(2:7)]
d2 <- d2[,-c(2:7)]
names <- c("Enterprise.Flag","Record.Number","MSA.Code","CT.Per.Min","Tract.Inc.Ratio","Borrower.Inc.Ratio",
"LoanToValue.Ratio","Purpose.Loan","Federal.Guarantee","Borrower.Race","CoBorrower.Race","Borrower.Gender",
"CoBorrower.Gender","Num.Units","Unit.Affordability","")
names(d1) <- names
names(d2) <- names
# Clears memory
rm(list = ls())
# Clears console
cat("\014")
library(tidyverse)
library(ggplot2)
# Fanny Mae
d1 <- read.delim("C:/Users/mc72574/Dropbox/UT/Teaching/2021Fall_STA235H/data/2019_SFNationalFileA2019/fnma_sf2019a_loans.txt", sep = " ")
# Freddy Mac
d2 <- read.delim("C:/Users/mc72574/Dropbox/UT/Teaching/2021Fall_STA235H/data/2019_SFNationalFileA2019/fhlmc_sf2019a_loans.txt", sep = " ")
d1 <- d1[,-c(2:7)]
d2 <- d2[,-c(2:7)]
names <- c("Enterprise.Flag","Record.Number","MSA.Code","CT.Per.Min","Tract.Inc.Ratio","Borrower.Inc.Ratio",
"LoanToValue.Ratio","Purpose.Loan","Federal.Guarantee","Borrower.Race","CoBorrower.Race","Borrower.Gender",
"CoBorrower.Gender","Num.Units","Unit.Affordability")
names(d1) <- names
names(d2) <- names
d <- d1 %>% add_row(d2)
table(d$LoanToValue.Ratio)
d <- d %>% filter(LoanToValue.Ratio==9)
table(d$LoanToValue.Ratio)
# Clears memory
rm(list = ls())
# Clears console
cat("\014")
library(tidyverse)
library(ggplot2)
# Fanny Mae
d1 <- read.delim("C:/Users/mc72574/Dropbox/UT/Teaching/2021Fall_STA235H/data/2019_SFNationalFileA2019/fnma_sf2019a_loans.txt", sep = " ")
# Freddy Mac
d2 <- read.delim("C:/Users/mc72574/Dropbox/UT/Teaching/2021Fall_STA235H/data/2019_SFNationalFileA2019/fhlmc_sf2019a_loans.txt", sep = " ")
d1 <- d1[,-c(2:7)]
d2 <- d2[,-c(2:7)]
names <- c("Enterprise.Flag","Record.Number","MSA.Code","CT.Per.Min","Tract.Inc.Ratio","Borrower.Inc.Ratio",
"LoanToValue.Ratio","Purpose.Loan","Federal.Guarantee","Borrower.Race","CoBorrower.Race","Borrower.Gender",
"CoBorrower.Gender","Num.Units","Unit.Affordability")
names(d1) <- names
names(d2) <- names
d <- d1 %>% add_row(d2)
d <- d %>% filter(LoanToValue.Ratio!=9 & (Borrower.Gende<=2))
d <- d %>% mutate(AfricanAmerican = ifelse(Borrower.Race==3,1,0),
Hispanic = ifelse(Borrower.Race==7,1,0),
Male = ifelse(Borrower.Race==1,1,0))
d <- d %>% filter(LoanToValue.Ratio!=9 & Borrower.Gender<=2)
d <- d %>% mutate(AfricanAmerican = ifelse(Borrower.Race==3,1,0),
Hispanic = ifelse(Borrower.Race==7,1,0),
Male = ifelse(Borrower.Race==1,1,0))
d <- d1 %>% add_row(d2)
table(d$Borrower.Gender)
table(is.na(d$Borrower.Gender))
d <- d1 %>% add_row(d2)
d <- d %>% filter(LoanToValue.Ratio!=9 & Borrower.Gender<=2)
d <- d %>% mutate(AfricanAmerican = ifelse(Borrower.Race==3,1,0),
Hispanic = ifelse(Borrower.Race==7,1,0),
Male = ifelse(Borrower.Race==1,1,0))
summary(lm(LoanToValue.Ratio ~ AfricanAmerican + Hispanic + Male + factor(Borrower.Inc.Ratio) + MSA.Code, data = d))
table(d$AfricanAmerican)
table(d$Hispanic)
summary(lm(LoanToValue.Ratio ~ AfricanAmerican + Male + factor(Borrower.Inc.Ratio) + MSA.Code, data = d))
d <- d1 %>% add_row(d2)
d <- d %>% filter(LoanToValue.Ratio!=9)
d <- d %>% mutate(AfricanAmerican = ifelse(Borrower.Race==3,1,0),
Hispanic = ifelse(Borrower.Race==7,1,0),
Male = ifelse(Borrower.Race==1,1,0))
summary(lm(LoanToValue.Ratio ~ AfricanAmerican + factor(Borrower.Inc.Ratio) + MSA.Code, data = d))
d <- d1 %>% add_row(d2)
table(d$Borrower.Inc.Ratio)
# Fanny Mae
d1 <- read.delim("C:/Users/mc72574/Dropbox/UT/Teaching/2021Fall_STA235H/data/2019_SFNationalFileA2019/fnma_sf2019a_loans.txt")
library(utils)
widths <- rep(1,15)
widths[2] <- 7
# Fanny Mae
d1 <- read.fwf("C:/Users/mc72574/Dropbox/UT/Teaching/2021Fall_STA235H/data/2019_SFNationalFileA2019/fnma_sf2019a_loans.txt", widths = widths)
# Clears memory
rm(list = ls())
# Clears console
cat("\014")
library(tidyverse)
library(ggplot2)
library(utils)
widths <- rep(1,15)
widths[2] <- 7
# Fanny Mae
d1 <- read.csv("C:/Users/mc72574/Dropbox/UT/Teaching/2021Fall_STA235H/data/2019_SFNationalFileA2019/fnma_sf2019a_loans.csv")
# Freddy Mac
d2 <- read.csv("C:/Users/mc72574/Dropbox/UT/Teaching/2021Fall_STA235H/data/2019_SFNationalFileA2019/fhlmc_sf2019a_loans.csv")
names <- c("Enterprise.Flag","Record.Number","MSA.Code","CT.Per.Min","Tract.Inc.Ratio","Borrower.Inc.Ratio",
"LoanToValue.Ratio","Purpose.Loan","Federal.Guarantee","Borrower.Race","CoBorrower.Race","Borrower.Gender",
"CoBorrower.Gender","Num.Units","Unit.Affordability")
names(d1) <- names
names(d2) <- names
d <- d1 %>% add_row(d2)
d <- d %>% filter(LoanToValue.Ratio!=9)
table(d$Borrower.Gender)
names(d1) <- names
names(d2) <- names
d <- d1 %>% add_row(d2)
d <- d %>% filter(LoanToValue.Ratio!=9 & Borrower.Gender<=2)
d <- d %>% mutate(AfricanAmerican = ifelse(Borrower.Race==3,1,0),
Hispanic = ifelse(Borrower.Race==7,1,0),
Male = ifelse(Borrower.Gender==1,1,0))
summary(lm(LoanToValue.Ratio ~ AfricanAmerican + factor(Borrower.Inc.Ratio) + MSA.Code, data = d))
d <- d1 %>% add_row(d2)
d <- d %>% filter(LoanToValue.Ratio!=9 & Borrower.Gender<=2)
d <- d %>% mutate(AfricanAmerican = ifelse(Borrower.Race==3,1,0),
Hispanic = ifelse(Borrower.Race==7,1,0),
Male = ifelse(Borrower.Gender==1,1,0),
Borrower.Inc.Ratio = factor(Borrower.Inc.Ratio, levels = c("Inc. Ratio 0-80%","Inc. Ratio 81-120%","Inc. Ratio >120%", "Inc. Ratio Missing")))
summary(lm(LoanToValue.Ratio ~ AfricanAmerican + factor(Borrower.Inc.Ratio) + MSA.Code, data = d))
table(d$Borrower.Inc.Ratio)
d <- d1 %>% add_row(d2)
d <- d %>% filter(LoanToValue.Ratio!=9 & Borrower.Gender<=2)
d <- d %>% mutate(AfricanAmerican = ifelse(Borrower.Race==3,1,0),
Hispanic = ifelse(Borrower.Race==7,1,0),
Male = ifelse(Borrower.Gender==1,1,0),
Borrower.Inc.Ratio = revalue(Borrower.Inc.Ratio,
c("1" = "Inc. Ratio 0-80%","2" = "Inc. Ratio 81-120%","3" = "Inc. Ratio >120%","9" = "Inc. Ratio Missing")))
d <- d1 %>% add_row(d2)
d <- d %>% filter(LoanToValue.Ratio!=9 & Borrower.Gender<=2)
d <- d %>% mutate(AfricanAmerican = ifelse(Borrower.Race==3,1,0),
Hispanic = ifelse(Borrower.Race==7,1,0),
Male = ifelse(Borrower.Gender==1,1,0))
d$Borrower.Inc.Ratio = revalue(factor(d$Borrower.Inc.Ratio), c("1" = "Inc. Ratio 0-80%","2" = "Inc. Ratio 81-120%","3" = "Inc. Ratio >120%","9" = "Inc. Ratio Missing"))
library(plyr)
d$Borrower.Inc.Ratio = revalue(factor(d$Borrower.Inc.Ratio), c("1" = "Inc. Ratio 0-80%","2" = "Inc. Ratio 81-120%","3" = "Inc. Ratio >120%","9" = "Inc. Ratio Missing"))
summary(lm(LoanToValue.Ratio ~ AfricanAmerican + Borrower.Inc.Ratio + MSA.Code, data = d))
d <- d1 %>% add_row(d2)
d <- d %>% filter(LoanToValue.Ratio!=9 & Borrower.Gender<=2)
d <- d %>% mutate(AfricanAmerican = ifelse(Borrower.Race==3,1,0),
Hispanic = ifelse(Borrower.Race==7,1,0),
Male = ifelse(Borrower.Gender==1,1,0))
d$Borrower.Inc.Ratio = revalue(factor(d$Borrower.Inc.Ratio), c("1" = "0-80%","2" = "81-120%","3" = ">120%","9" = "Missing"))
summary(lm(LoanToValue.Ratio ~ AfricanAmerican + Borrower.Inc.Ratio + MSA.Code, data = d))
d <- d1 %>% add_row(d2)
d <- d %>% filter(LoanToValue.Ratio!=9 & Borrower.Gender<=2)
d <- d %>% mutate(AfricanAmerican = ifelse(Borrower.Race==3,1,0),
Hispanic = ifelse(Borrower.Race==7,1,0),
Male = ifelse(Borrower.Gender==1,1,0))
d$Borrower.Inc.Ratio = revalue(factor(d$Borrower.Inc.Ratio), c("1" = " 0-80%","2" = " 81-120%","3" = " >120%","9" = " Missing"))
summary(lm(LoanToValue.Ratio ~ AfricanAmerican + Male + Borrower.Inc.Ratio + MSA.Code, data = d))
summary(lm(LoanToValue.Ratio ~ AfricanAmerican + Male + Borrower.Inc.Ratio + CT.Per.Min, data = d))
summary(lm(LoanToValue.Ratio ~ AfricanAmerican*Borrower.Inc.Ratio + Male + CT.Per.Min, data = d))
# Clears memory
rm(list = ls())
# Clears console
cat("\014")
library(tidyverse)
library(ggplot2)
library(plyr)
d <- read.csv("C:/Users/mc72574/Dropbox/UT/Teaching/2021Fall_STA235H/data/hmda_2017_tx_first-lien-owner-occupied-1-4-family-records_labels/hmda_2017_tx_first-lien-owner-occupied-1-4-family-records_labels.csv")
d <- read.csv("C:/Users/mc72574/Dropbox/UT/Teaching/2021Fall_STA235H/data/hmda_2017_tx_first-lien-owner-occupied-1-4-family-records_labels/hmda_2017_tx_first-lien-owner-occupied-1-4-family-records_labels.csv",
stringsAsFactors = FALSE)
# Keep only loan purpose
d <- d %>% filter (loan_purpose==1)
