axis.text.y = element_text(size=10),legend.position="none",
title = element_text(size=14))
ggplot(data = d, aes(x = factor(t), y = y, fill=factor(z))) +
geom_boxplot(position = "dodge") +
geom_smooth(aes(group = factor(z))) +
theme_bw()+
theme_ipsum_fsc(plot_title_face = "bold") + #plain
xlab("Time") + ylab("Outcome")+ ggtitle("Not matched") +
theme(plot.margin=unit(c(1,1,1.5,1.2),"cm"),
panel.grid.major.x = element_blank(),
panel.grid.minor.x = element_blank(),
panel.grid.major.y = element_blank(),
panel.grid.minor.y = element_blank(),
axis.line = element_line(colour = "dark grey"),legend.position="none")+
theme(axis.title.x = element_text(size=24),#margin = margin(t = 10, r = 0, b = 0, l = 0)),
axis.text.x = element_text(size=10,angle = 45,hjust=1,vjust=1,margin=margin(0.1,0,0,0)),
axis.title.y = element_text(size=24),#margin = margin(t = 0, r = 10, b = 0, l = 0)),
axis.text.y = element_text(size=10),legend.position="none",
title = element_text(size=14))
ggplot(data = d, aes(x = factor(t), y = y, fill=factor(z))) +
geom_boxplot(position = "dodge") +
geom_smooth(aes(group = factor(z))) +
theme_bw()+
theme_ipsum_fsc(plot_title_face = "bold") + #plain
xlab("Time") + ylab("Outcome")+ ggtitle("Not matched") +
theme(plot.margin=unit(c(1,1,1.5,1.2),"cm"),
panel.grid.major.x = element_blank(),
panel.grid.minor.x = element_blank(),
panel.grid.major.y = element_blank(),
panel.grid.minor.y = element_blank(),
axis.line = element_line(colour = "dark grey"),legend.position="none")+
theme(axis.title.x = element_text(size=16),#margin = margin(t = 10, r = 0, b = 0, l = 0)),
axis.text.x = element_text(size=10,angle = 45,hjust=1,vjust=1,margin=margin(0.1,0,0,0)),
axis.title.y = element_text(size=16),#margin = margin(t = 0, r = 10, b = 0, l = 0)),
axis.text.y = element_text(size=10),legend.position="none",
title = element_text(size=14))
ggplot(data = dm, aes(x = factor(t), y = y, fill=factor(z))) +
geom_boxplot(position = "dodge") +
geom_smooth(aes(group = factor(z))) +
theme_bw()+
theme_ipsum_fsc(plot_title_face = "bold") + #plain
xlab("Time") + ylab("Outcome")+ ggtitle("Not matched") +
theme(plot.margin=unit(c(1,1,1.5,1.2),"cm"),
panel.grid.major.x = element_blank(),
panel.grid.minor.x = element_blank(),
panel.grid.major.y = element_blank(),
panel.grid.minor.y = element_blank(),
axis.line = element_line(colour = "dark grey"),legend.position="none")+
theme(axis.title.x = element_text(size=16),#margin = margin(t = 10, r = 0, b = 0, l = 0)),
axis.text.x = element_text(size=10,angle = 45,hjust=1,vjust=1,margin=margin(0.1,0,0,0)),
axis.title.y = element_text(size=16),#margin = margin(t = 0, r = 10, b = 0, l = 0)),
axis.text.y = element_text(size=10),legend.position="none",
title = element_text(size=14))
ggplot(data = d, aes(x = factor(t), y = y, fill=factor(z), color=factor(z))) +
geom_boxplot(position = "dodge") +
geom_smooth(aes(group = factor(z))) +
scale_color_manual(values=c("#F89441","#900DA4")) +
scale_fill_manual(values=c("#F89441","#900DA4")) +
theme_bw()+
theme_ipsum_fsc(plot_title_face = "bold") + #plain
xlab("Time") + ylab("Outcome")+ ggtitle("Not matched") +
theme(plot.margin=unit(c(1,1,1.5,1.2),"cm"),
panel.grid.major.x = element_blank(),
panel.grid.minor.x = element_blank(),
panel.grid.major.y = element_blank(),
panel.grid.minor.y = element_blank(),
axis.line = element_line(colour = "dark grey"),legend.position="none")+
theme(axis.title.x = element_text(size=16),#margin = margin(t = 10, r = 0, b = 0, l = 0)),
axis.text.x = element_text(size=10,angle = 45,hjust=1,vjust=1,margin=margin(0.1,0,0,0)),
axis.title.y = element_text(size=16),#margin = margin(t = 0, r = 10, b = 0, l = 0)),
axis.text.y = element_text(size=10),legend.position="none",
title = element_text(size=14))
ggplot(data = d, aes(x = factor(t), y = y, fill=factor(z), color=factor(z))) +
geom_boxplot(position = "dodge") +
geom_smooth(aes(group = factor(z))) +
scale_color_manual(values=c("#F89441","#900DA4")) +
scale_fill_manual(values=c(alpha("#F89441",0.3),alpha("#900DA4",0.3))) +
theme_bw()+
theme_ipsum_fsc(plot_title_face = "bold") + #plain
xlab("Time") + ylab("Outcome")+ ggtitle("Not matched") +
theme(plot.margin=unit(c(1,1,1.5,1.2),"cm"),
panel.grid.major.x = element_blank(),
panel.grid.minor.x = element_blank(),
panel.grid.major.y = element_blank(),
panel.grid.minor.y = element_blank(),
axis.line = element_line(colour = "dark grey"),legend.position="none")+
theme(axis.title.x = element_text(size=16),#margin = margin(t = 10, r = 0, b = 0, l = 0)),
axis.text.x = element_text(size=10,angle = 45,hjust=1,vjust=1,margin=margin(0.1,0,0,0)),
axis.title.y = element_text(size=16),#margin = margin(t = 0, r = 10, b = 0, l = 0)),
axis.text.y = element_text(size=10),legend.position="none",
title = element_text(size=14))
ggplot(data = d, aes(x = factor(t), y = y, fill=factor(z), color=factor(z))) +
geom_boxplot(position = "dodge") +
geom_smooth(aes(group = factor(z))) +
scale_color_manual(values=c("#F89441","#900DA4")) +
scale_fill_manual(values=c(alpha("#F89441",0.3),alpha("#900DA4",0.3))) +
theme_bw()+
theme_ipsum_fsc(plot_title_face = "bold") + #plain
xlab("Time") + ylab("Outcome")+ ggtitle("Not matched") +
theme(plot.margin=unit(c(1,1,1.5,1.2),"cm"),
panel.grid.major.x = element_blank(),
panel.grid.minor.x = element_blank(),
panel.grid.major.y = element_blank(),
panel.grid.minor.y = element_blank(),
axis.line = element_line(colour = "dark grey"),legend.position="none")+
theme(axis.title.x = element_text(size=16),#margin = margin(t = 10, r = 0, b = 0, l = 0)),
axis.text.x = element_text(size=10,angle = 0,hjust=1,vjust=1,margin=margin(0.1,0,0,0)),
axis.title.y = element_text(size=16),#margin = margin(t = 0, r = 10, b = 0, l = 0)),
axis.text.y = element_text(size=10),legend.position="none",
title = element_text(size=14))
ggplot(data = d, aes(x = factor(t), y = y, fill=factor(z), color=factor(z))) +
geom_vline(xintercept = 0, lty=2) +
geom_boxplot(position = "dodge") +
geom_smooth(aes(group = factor(z))) +
scale_color_manual(values=c("#F89441","#900DA4")) +
scale_fill_manual(values=c(alpha("#F89441",0.3),alpha("#900DA4",0.3))) +
theme_bw()+
theme_ipsum_fsc(plot_title_face = "bold") + #plain
xlab("Time") + ylab("Outcome")+ ggtitle("Not matched") +
theme(plot.margin=unit(c(1,1,1.5,1.2),"cm"),
panel.grid.major.x = element_blank(),
panel.grid.minor.x = element_blank(),
panel.grid.major.y = element_blank(),
panel.grid.minor.y = element_blank(),
axis.line = element_line(colour = "dark grey"),legend.position="none")+
theme(axis.title.x = element_text(size=16),#margin = margin(t = 10, r = 0, b = 0, l = 0)),
axis.text.x = element_text(size=10,angle = 0,hjust=1,vjust=1,margin=margin(0.1,0,0,0)),
axis.title.y = element_text(size=16),#margin = margin(t = 0, r = 10, b = 0, l = 0)),
axis.text.y = element_text(size=10),legend.position="none",
title = element_text(size=14))
ggplot(data = d, aes(x = factor(t), y = y, fill=factor(z), color=factor(z))) +
geom_vline(xintercept = "0", lty=2) +
geom_boxplot(position = "dodge") +
geom_smooth(aes(group = factor(z))) +
scale_color_manual(values=c("#F89441","#900DA4")) +
scale_fill_manual(values=c(alpha("#F89441",0.3),alpha("#900DA4",0.3))) +
theme_bw()+
theme_ipsum_fsc(plot_title_face = "bold") + #plain
xlab("Time") + ylab("Outcome")+ ggtitle("Not matched") +
theme(plot.margin=unit(c(1,1,1.5,1.2),"cm"),
panel.grid.major.x = element_blank(),
panel.grid.minor.x = element_blank(),
panel.grid.major.y = element_blank(),
panel.grid.minor.y = element_blank(),
axis.line = element_line(colour = "dark grey"),legend.position="none")+
theme(axis.title.x = element_text(size=16),#margin = margin(t = 10, r = 0, b = 0, l = 0)),
axis.text.x = element_text(size=10,angle = 0,hjust=1,vjust=1,margin=margin(0.1,0,0,0)),
axis.title.y = element_text(size=16),#margin = margin(t = 0, r = 10, b = 0, l = 0)),
axis.text.y = element_text(size=10),legend.position="none",
title = element_text(size=14))
ggplot(data = d, aes(x = factor(t), y = y, fill=factor(z), color=factor(z))) +
geom_vline(xintercept = "0", lty=2) +
geom_boxplot(position = "dodge") +
geom_smooth(aes(group = factor(z))) +
scale_color_manual(values=c("#F89441","#900DA4")) +
scale_fill_manual(values=c(alpha("#F89441",0.3),alpha("#900DA4",0.3))) +
theme_bw()+
theme_ipsum_fsc(plot_title_face = "bold") + #plain
xlab("Time") + ylab("Outcome")+ ggtitle("Not matched") +
theme(plot.margin=unit(c(1,1,1.5,1.2),"cm"),
panel.grid.major.x = element_blank(),
panel.grid.minor.x = element_blank(),
panel.grid.major.y = element_blank(),
panel.grid.minor.y = element_blank(),
axis.line = element_line(colour = "dark grey"),legend.position="none")+
theme(axis.title.x = element_text(size=16),#margin = margin(t = 10, r = 0, b = 0, l = 0)),
axis.text.x = element_text(size=10,angle = 0,hjust=0.5,vjust=1,margin=margin(0.1,0,0,0)),
axis.title.y = element_text(size=16),#margin = margin(t = 0, r = 10, b = 0, l = 0)),
axis.text.y = element_text(size=10),legend.position="none",
title = element_text(size=14))
ggplot(data = dm, aes(x = factor(t), y = y, fill=factor(z))) +
geom_vline(xintercept = "0", lty=2) +
geom_boxplot(position = "dodge") +
geom_smooth(aes(group = factor(z))) +
scale_color_manual(values=c("#F89441","#900DA4")) +
scale_fill_manual(values=c(alpha("#F89441",0.3),alpha("#900DA4",0.3))) +
theme_bw()+
theme_ipsum_fsc(plot_title_face = "bold") + #plain
xlab("Time") + ylab("Outcome")+ ggtitle("Matched") +
theme(plot.margin=unit(c(1,1,1.5,1.2),"cm"),
panel.grid.major.x = element_blank(),
panel.grid.minor.x = element_blank(),
panel.grid.major.y = element_blank(),
panel.grid.minor.y = element_blank(),
axis.line = element_line(colour = "dark grey"),legend.position="none")+
theme(axis.title.x = element_text(size=16),#margin = margin(t = 10, r = 0, b = 0, l = 0)),
axis.text.x = element_text(size=10,angle = 45,hjust=1,vjust=1,margin=margin(0.1,0,0,0)),
axis.title.y = element_text(size=16),#margin = margin(t = 0, r = 10, b = 0, l = 0)),
axis.text.y = element_text(size=10),legend.position="none",
title = element_text(size=14))
ggplot(data = dm, aes(x = factor(t), y = y, fill=factor(z), color=factor(z))) +
geom_vline(xintercept = "0", lty=2) +
geom_boxplot(position = "dodge") +
geom_smooth(aes(group = factor(z))) +
scale_color_manual(values=c("#F89441","#900DA4")) +
scale_fill_manual(values=c(alpha("#F89441",0.3),alpha("#900DA4",0.3))) +
theme_bw()+
theme_ipsum_fsc(plot_title_face = "bold") + #plain
xlab("Time") + ylab("Outcome")+ ggtitle("Matched") +
theme(plot.margin=unit(c(1,1,1.5,1.2),"cm"),
panel.grid.major.x = element_blank(),
panel.grid.minor.x = element_blank(),
panel.grid.major.y = element_blank(),
panel.grid.minor.y = element_blank(),
axis.line = element_line(colour = "dark grey"),legend.position="none")+
theme(axis.title.x = element_text(size=16),#margin = margin(t = 10, r = 0, b = 0, l = 0)),
axis.text.x = element_text(size=10,angle = 45,hjust=1,vjust=1,margin=margin(0.1,0,0,0)),
axis.title.y = element_text(size=16),#margin = margin(t = 0, r = 10, b = 0, l = 0)),
axis.text.y = element_text(size=10),legend.position="none",
title = element_text(size=14))
ggplot(data = dm, aes(x = factor(t), y = y, fill=factor(z), color=factor(z))) +
geom_vline(xintercept = "0", lty=2) +
geom_boxplot(position = "dodge") +
geom_smooth(aes(group = factor(z))) +
scale_color_manual(values=c("#F89441","#900DA4")) +
scale_fill_manual(values=c(alpha("#F89441",0.3),alpha("#900DA4",0.3))) +
theme_bw()+
theme_ipsum_fsc(plot_title_face = "bold") + #plain
xlab("Time") + ylab("Outcome")+ ggtitle("Matched") +
theme(plot.margin=unit(c(1,1,1.5,1.2),"cm"),
panel.grid.major.x = element_blank(),
panel.grid.minor.x = element_blank(),
panel.grid.major.y = element_blank(),
panel.grid.minor.y = element_blank(),
axis.line = element_line(colour = "dark grey"),legend.position="none")+
theme(axis.title.x = element_text(size=16),#margin = margin(t = 10, r = 0, b = 0, l = 0)),
axis.text.x = element_text(size=10,angle = 0,hjust=0.5,vjust=1,margin=margin(0.1,0,0,0)),
axis.title.y = element_text(size=16),#margin = margin(t = 0, r = 10, b = 0, l = 0)),
axis.text.y = element_text(size=10),legend.position="none",
title = element_text(size=14))
library(ggplot2)
library(dplyr)
library(MatchIt)
library(tidyverse)
library(hrbrthemes)
library(firasans)
set.seed(101)
d = rbind(cbind(rnorm(100,0,1),-3,0,seq(1,100)),
cbind(rnorm(100,0,1),-2,0,seq(1,100)),
cbind(rnorm(100,0,1),-1,0,seq(1,100)),
cbind(rnorm(100,0,1),0,0,seq(1,100)),
cbind(rnorm(100,0,1),1,0,seq(1,100)),
cbind(rnorm(100,0,1),2,0,seq(1,100)),
cbind(rnorm(100,0,1),3,0,seq(1,100)),
cbind(rnorm(100,0.5,1),-3,1,seq(101,200)),
cbind(rnorm(100,0.5,1),-2,1,seq(101,200)),
cbind(rnorm(100,0.5,1),-1,1,seq(101,200)),
cbind(rnorm(100,0.5,1),0,1,seq(101,200)),
cbind(rnorm(100,0.5,1),1,1,seq(101,200)),
cbind(rnorm(100,0.5,1),2,1,seq(101,200)),
cbind(rnorm(100,0.5,1),3,1,seq(101,200)))
d = as.data.frame(d)
names(d) = c("x","t","z","id")
d$y = d$x + rnorm(nrow(d),0.5,0.05)
g1 = ggplot(data = d, aes(x = factor(t), y = y, fill=factor(z), color=factor(z))) +
geom_vline(xintercept = "0", lty=2) +
geom_boxplot(position = "dodge") +
geom_smooth(aes(group = factor(z))) +
scale_color_manual(values=c("#F89441","#900DA4")) +
scale_fill_manual(values=c(alpha("#F89441",0.3),alpha("#900DA4",0.3))) +
theme_bw()+
theme_ipsum_fsc(plot_title_face = "bold") + #plain
xlab("Time") + ylab("Outcome")+ ggtitle("Not matched") +
theme(plot.margin=unit(c(1,1,1.5,1.2),"cm"),
panel.grid.major.x = element_blank(),
panel.grid.minor.x = element_blank(),
panel.grid.major.y = element_blank(),
panel.grid.minor.y = element_blank(),
axis.line = element_line(colour = "dark grey"),legend.position="none")+
theme(axis.title.x = element_text(size=16),#margin = margin(t = 10, r = 0, b = 0, l = 0)),
axis.text.x = element_text(size=10,angle = 0,hjust=0.5,vjust=1,margin=margin(0.1,0,0,0)),
axis.title.y = element_text(size=16),#margin = margin(t = 0, r = 10, b = 0, l = 0)),
axis.text.y = element_text(size=10),legend.position="none",
title = element_text(size=14))
### Matching
d_wide = d %>% pivot_wider(id_cols = id, names_from = t, values_from = y, names_prefix = "y")
d_wide$z = 0
d_wide$z[d_wide$id %in% unique(d$id[d$z==1])] = 1
match.1 = matchit(z ~ `y-3` + `y-2` + `y-1` + `y0`, data = d_wide, method = "nearest", discard = "both", caliper = 0.3)
d_m <- match.data(match.1)
table(d_m$z)
dm = pivot_longer(d_m, cols = starts_with("y"), names_to = "y")
dm$t = NA
dm$t[dm$y=="y-3"] = -3
dm$t[dm$y=="y-2"] = -2
dm$t[dm$y=="y-1"] = -1
dm$t[dm$y=="y0"] = -0
dm$t[dm$y=="y1"] = 1
dm$t[dm$y=="y2"] = 2
dm$t[dm$y=="y3"] = 3
dm$y = dm$value
g2 = ggplot(data = dm, aes(x = factor(t), y = y, fill=factor(z), color=factor(z))) +
geom_vline(xintercept = "0", lty=2) +
geom_boxplot(position = "dodge") +
geom_smooth(aes(group = factor(z))) +
scale_color_manual(values=c("#F89441","#900DA4")) +
scale_fill_manual(values=c(alpha("#F89441",0.3),alpha("#900DA4",0.3))) +
theme_bw()+
theme_ipsum_fsc(plot_title_face = "bold") + #plain
xlab("Time") + ylab("Outcome")+ ggtitle("Matched") +
theme(plot.margin=unit(c(1,1,1.5,1.2),"cm"),
panel.grid.major.x = element_blank(),
panel.grid.minor.x = element_blank(),
panel.grid.major.y = element_blank(),
panel.grid.minor.y = element_blank(),
axis.line = element_line(colour = "dark grey"),legend.position="none")+
theme(axis.title.x = element_text(size=16),#margin = margin(t = 10, r = 0, b = 0, l = 0)),
axis.text.x = element_text(size=10,angle = 0,hjust=0.5,vjust=1,margin=margin(0.1,0,0,0)),
axis.title.y = element_text(size=16),#margin = margin(t = 0, r = 10, b = 0, l = 0)),
axis.text.y = element_text(size=10),legend.position="none",
title = element_text(size=14))
gridExtra
library(gridExtra)
?grid.arrange
grid.arrange(g1,g2)
?grid.arrange
?margin
ggplot(data = dm, aes(x = factor(t), y = y, fill=factor(z), color=factor(z))) +
geom_vline(xintercept = "0", lty=2) +
geom_boxplot(position = "dodge") +
geom_smooth(aes(group = factor(z))) +
scale_color_manual(values=c("#F89441","#900DA4")) +
scale_fill_manual(values=c(alpha("#F89441",0.3),alpha("#900DA4",0.3))) +
theme_bw()+
theme_ipsum_fsc(plot_title_face = "bold") + #plain
xlab("Time") + ylab("Outcome")+ ggtitle("Matched") +
theme(plot.margin=unit(c(1,1,1.5,1.2),"cm"),
panel.grid.major.x = element_blank(),
panel.grid.minor.x = element_blank(),
panel.grid.major.y = element_blank(),
panel.grid.minor.y = element_blank(),
axis.line = element_line(colour = "dark grey"),legend.position="none")+
theme(axis.title.x = element_text(size=16),#margin = margin(t = 10, r = 0, b = 0, l = 0)),
axis.text.x = element_text(size=10,angle = 0,hjust=0.5,vjust=1,margin=margin(0.1,0,0,0)),
axis.title.y = element_text(size=16),#margin = margin(t = 0, r = 10, b = 0, l = 0)),
axis.text.y = element_text(size=10),legend.position="none",
title = element_text(size=14)) +
theme(plot.margin = unit(c(0.5,1,0.5,1), "cm"))
library(ggplot2)
library(dplyr)
library(MatchIt)
library(tidyverse)
library(hrbrthemes)
library(firasans)
library(gridExtra)
set.seed(101)
d = rbind(cbind(rnorm(100,0,1),-3,0,seq(1,100)),
cbind(rnorm(100,0,1),-2,0,seq(1,100)),
cbind(rnorm(100,0,1),-1,0,seq(1,100)),
cbind(rnorm(100,0,1),0,0,seq(1,100)),
cbind(rnorm(100,0,1),1,0,seq(1,100)),
cbind(rnorm(100,0,1),2,0,seq(1,100)),
cbind(rnorm(100,0,1),3,0,seq(1,100)),
cbind(rnorm(100,0.5,1),-3,1,seq(101,200)),
cbind(rnorm(100,0.5,1),-2,1,seq(101,200)),
cbind(rnorm(100,0.5,1),-1,1,seq(101,200)),
cbind(rnorm(100,0.5,1),0,1,seq(101,200)),
cbind(rnorm(100,0.5,1),1,1,seq(101,200)),
cbind(rnorm(100,0.5,1),2,1,seq(101,200)),
cbind(rnorm(100,0.5,1),3,1,seq(101,200)))
d = as.data.frame(d)
names(d) = c("x","t","z","id")
d$y = d$x + rnorm(nrow(d),0.5,0.05)
g1 = ggplot(data = d, aes(x = factor(t), y = y, fill=factor(z), color=factor(z))) +
geom_vline(xintercept = "0", lty=2) +
geom_boxplot(position = "dodge") +
geom_smooth(aes(group = factor(z))) +
scale_color_manual(values=c("#F89441","#900DA4")) +
scale_fill_manual(values=c(alpha("#F89441",0.3),alpha("#900DA4",0.3))) +
theme_bw()+
theme_ipsum_fsc(plot_title_face = "bold") + #plain
xlab("Time") + ylab("Outcome")+ ggtitle("Not matched") +
theme(plot.margin=unit(c(1,1,1.5,1.2),"cm"),
panel.grid.major.x = element_blank(),
panel.grid.minor.x = element_blank(),
panel.grid.major.y = element_blank(),
panel.grid.minor.y = element_blank(),
axis.line = element_line(colour = "dark grey"),legend.position="none")+
theme(axis.title.x = element_text(size=16),#margin = margin(t = 10, r = 0, b = 0, l = 0)),
axis.text.x = element_text(size=10,angle = 0,hjust=0.5,vjust=1,margin=margin(0.1,0,0,0)),
axis.title.y = element_text(size=16),#margin = margin(t = 0, r = 10, b = 0, l = 0)),
axis.text.y = element_text(size=10),legend.position="none",
title = element_text(size=14)) +
theme(plot.margin = unit(c(0.5,1,0.5,1), "cm"))
### Matching
d_wide = d %>% pivot_wider(id_cols = id, names_from = t, values_from = y, names_prefix = "y")
d_wide$z = 0
d_wide$z[d_wide$id %in% unique(d$id[d$z==1])] = 1
match.1 = matchit(z ~ `y-3` + `y-2` + `y-1` + `y0`, data = d_wide, method = "nearest", discard = "both", caliper = 0.3)
d_m <- match.data(match.1)
table(d_m$z)
dm = pivot_longer(d_m, cols = starts_with("y"), names_to = "y")
dm$t = NA
dm$t[dm$y=="y-3"] = -3
dm$t[dm$y=="y-2"] = -2
dm$t[dm$y=="y-1"] = -1
dm$t[dm$y=="y0"] = -0
dm$t[dm$y=="y1"] = 1
dm$t[dm$y=="y2"] = 2
dm$t[dm$y=="y3"] = 3
dm$y = dm$value
g2 = ggplot(data = dm, aes(x = factor(t), y = y, fill=factor(z), color=factor(z))) +
geom_vline(xintercept = "0", lty=2) +
geom_boxplot(position = "dodge") +
geom_smooth(aes(group = factor(z))) +
scale_color_manual(values=c("#F89441","#900DA4")) +
scale_fill_manual(values=c(alpha("#F89441",0.3),alpha("#900DA4",0.3))) +
theme_bw()+
theme_ipsum_fsc(plot_title_face = "bold") + #plain
xlab("Time") + ylab("Outcome")+ ggtitle("Matched") +
theme(plot.margin=unit(c(1,1,1.5,1.2),"cm"),
panel.grid.major.x = element_blank(),
panel.grid.minor.x = element_blank(),
panel.grid.major.y = element_blank(),
panel.grid.minor.y = element_blank(),
axis.line = element_line(colour = "dark grey"),legend.position="none")+
theme(axis.title.x = element_text(size=16),#margin = margin(t = 10, r = 0, b = 0, l = 0)),
axis.text.x = element_text(size=10,angle = 0,hjust=0.5,vjust=1,margin=margin(0.1,0,0,0)),
axis.title.y = element_text(size=16),#margin = margin(t = 0, r = 10, b = 0, l = 0)),
axis.text.y = element_text(size=10),legend.position="none",
title = element_text(size=14)) +
theme(plot.margin = unit(c(0.5,1,0.5,1), "cm"))
grid.arrange(g1,g2)
library(ggplot2)
library(dplyr)
library(MatchIt)
library(tidyverse)
library(hrbrthemes)
library(firasans)
library(gridExtra)
set.seed(101)
d = rbind(cbind(rnorm(100,0,1),-3,0,seq(1,100)),
cbind(rnorm(100,0,1),-2,0,seq(1,100)),
cbind(rnorm(100,0,1),-1,0,seq(1,100)),
cbind(rnorm(100,0,1),0,0,seq(1,100)),
cbind(rnorm(100,0,1),1,0,seq(1,100)),
cbind(rnorm(100,0,1),2,0,seq(1,100)),
cbind(rnorm(100,0,1),3,0,seq(1,100)),
cbind(rnorm(100,0.5,1),-3,1,seq(101,200)),
cbind(rnorm(100,0.5,1),-2,1,seq(101,200)),
cbind(rnorm(100,0.5,1),-1,1,seq(101,200)),
cbind(rnorm(100,0.5,1),0,1,seq(101,200)),
cbind(rnorm(100,0.5,1),1,1,seq(101,200)),
cbind(rnorm(100,0.5,1),2,1,seq(101,200)),
cbind(rnorm(100,0.5,1),3,1,seq(101,200)))
d = as.data.frame(d)
names(d) = c("x","t","z","id")
d$y = d$x + rnorm(nrow(d),0.5,0.05)
g1 = ggplot(data = d, aes(x = factor(t), y = y, fill=factor(z), color=factor(z))) +
geom_vline(xintercept = "0", lty=2) +
geom_boxplot(position = "dodge") +
geom_smooth(aes(group = factor(z))) +
scale_color_manual(values=c("#F89441","#900DA4")) +
scale_fill_manual(values=c(alpha("#F89441",0.3),alpha("#900DA4",0.3))) +
theme_bw()+
theme_ipsum_fsc(plot_title_face = "bold") + #plain
xlab("Time") + ylab("Outcome")+ ggtitle("Not matched") +
theme(plot.margin=unit(c(1,1,1.5,1.2),"cm"),
panel.grid.major.x = element_blank(),
panel.grid.minor.x = element_blank(),
panel.grid.major.y = element_blank(),
panel.grid.minor.y = element_blank(),
axis.line = element_line(colour = "dark grey"),legend.position="none")+
theme(axis.title.x = element_text(size=16),#margin = margin(t = 10, r = 0, b = 0, l = 0)),
axis.text.x = element_text(size=10,angle = 0,hjust=0.5,vjust=1,margin=margin(0.1,0,0,0)),
axis.title.y = element_text(size=16),#margin = margin(t = 0, r = 10, b = 0, l = 0)),
axis.text.y = element_text(size=10),legend.position="none",
title = element_text(size=14)) +
theme(plot.margin = unit(c(0,1,0,1), "cm"))
### Matching
d_wide = d %>% pivot_wider(id_cols = id, names_from = t, values_from = y, names_prefix = "y")
d_wide$z = 0
d_wide$z[d_wide$id %in% unique(d$id[d$z==1])] = 1
match.1 = matchit(z ~ `y-3` + `y-2` + `y-1` + `y0`, data = d_wide, method = "nearest", discard = "both", caliper = 0.3)
d_m <- match.data(match.1)
table(d_m$z)
dm = pivot_longer(d_m, cols = starts_with("y"), names_to = "y")
dm$t = NA
dm$t[dm$y=="y-3"] = -3
dm$t[dm$y=="y-2"] = -2
dm$t[dm$y=="y-1"] = -1
dm$t[dm$y=="y0"] = -0
dm$t[dm$y=="y1"] = 1
dm$t[dm$y=="y2"] = 2
dm$t[dm$y=="y3"] = 3
dm$y = dm$value
g2 = ggplot(data = dm, aes(x = factor(t), y = y, fill=factor(z), color=factor(z))) +
geom_vline(xintercept = "0", lty=2) +
geom_boxplot(position = "dodge") +
geom_smooth(aes(group = factor(z))) +
scale_color_manual(values=c("#F89441","#900DA4")) +
scale_fill_manual(values=c(alpha("#F89441",0.3),alpha("#900DA4",0.3))) +
theme_bw()+
theme_ipsum_fsc(plot_title_face = "bold") + #plain
xlab("Time") + ylab("Outcome")+ ggtitle("Matched") +
theme(plot.margin=unit(c(1,1,1.5,1.2),"cm"),
panel.grid.major.x = element_blank(),
panel.grid.minor.x = element_blank(),
panel.grid.major.y = element_blank(),
panel.grid.minor.y = element_blank(),
axis.line = element_line(colour = "dark grey"),legend.position="none")+
theme(axis.title.x = element_text(size=16),#margin = margin(t = 10, r = 0, b = 0, l = 0)),
axis.text.x = element_text(size=10,angle = 0,hjust=0.5,vjust=1,margin=margin(0.1,0,0,0)),
axis.title.y = element_text(size=16),#margin = margin(t = 0, r = 10, b = 0, l = 0)),
axis.text.y = element_text(size=10),legend.position="none",
title = element_text(size=14)) +
theme(plot.margin = unit(c(0,1,0,1), "cm"))
grid.arrange(g1,g2)
install.packages("causaldata")
2*60+35
2*60+25
pagedown::chrome_print('C:/Users/mc72574/Dropbox/Hugo/Sites/sta235/exampleSite/content/Classes/Week1/1_Intro/f2021_sta235h_1_intro.html')
