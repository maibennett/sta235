<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>STA 235 - Causal Inference: Randomized Controlled Trials</title>
    <meta charset="utf-8" />
    <meta name="author" content="McCombs School of Business, UT Austin" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <script src="libs/htmlwidgets/htmlwidgets.js"></script>
    <script src="libs/plotly-binding/plotly.js"></script>
    <script src="libs/typedarray/typedarray.min.js"></script>
    <script src="libs/jquery/jquery.min.js"></script>
    <link href="libs/crosstalk/css/crosstalk.css" rel="stylesheet" />
    <script src="libs/crosstalk/js/crosstalk.min.js"></script>
    <link href="libs/plotly-htmlwidgets-css/plotly-htmlwidgets.css" rel="stylesheet" />
    <script src="libs/plotly-main/plotly-latest.min.js"></script>
    <script src="libs/core-js/shim.min.js"></script>
    <script src="libs/react/react.min.js"></script>
    <script src="libs/react/react-dom.min.js"></script>
    <script src="libs/reactwidget/react-tools.js"></script>
    <script src="libs/reactable-binding/reactable.js"></script>
    <script src="https://use.fontawesome.com/5235085b15.js"></script>
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
    <link rel="stylesheet" href="custom.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# STA 235 - Causal Inference: Randomized Controlled Trials
## Spring 2021
### McCombs School of Business, UT Austin

---





&lt;style type="text/css"&gt;

.small .remark-code { /*Change made here*/
  font-size: 80% !important;
}

.tiny .remark-code { /*Change made here*/
  font-size: 90% !important;
}
&lt;/style&gt;








# Last week

.pull-left[
- **.darkorange[Potential Outcomes Framework]**
  
  - What are potential outcomes?
  - Definition of causal effects and estimands
  

- **.darkorange[Bias in Causal Inference]**:
  
  - Ignorability assumption
  - Confounding vs Collider Bias
]

.pull-right[
&lt;br&gt;
&lt;br&gt;
![:scale 100%](https://github.com/maibennett/sta235/raw/main/exampleSite/content/Classes/Week4/1_RCT/images/correlation.png)
]
---
# Today

.pull-left[
&lt;br&gt;
&lt;br&gt;
![](https://github.com/maibennett/sta235/raw/main/exampleSite/content/Classes/Week4/1_RCT/images/xkcd-p-value-jellybeans.jpg)
]
.pull-right[
- **.darkorange[Randomized Controlled Trials]**:
  
  .box-2t[Assumptions: The power of randomization]
  
  .box-4t[Design: What should we consider?]
  
  .box-7t[Limitations: Gold Standard?]
]

---
background-position: 50% 50%
class: left, bottom, inverse
.big[
The Magic of Randomization
]


---
# The Fundamental Problem of Causal Inference

- Remember that we can only see one potential outcome 
  
  - E.g. if `\(Z\)` is binary, either `\(Y(0)\)` **OR** `\(Y(1)\)`

&lt;br&gt;
.box-7[Fundamental Problem of Causal Inference]

--

- Need for the **.darkorange[ignorability assumption]**

`$$Y(z) \perp\!\!\!\perp Z \ \ \ \ \ \forall \ z\in Z$$`
--

- Most times, **.darkorange[the ignorability assumption doesn't hold]**

  - Why? (Remember the two types of bias we saw the previous class?)
  
---
# Ignorability Assumption


`$$(Y(0), Y(1)) \perp\!\!\!\perp Z$$`


- Most times, **.darkorange[the ignorability assumption doesn't hold]**

  - For ATE:
  
.box-2t[Selection bias]
&lt;br&gt;
.box-4t[Heterogeneous treatment effect bias]
  
---
# The problem with self-selection

<div id="htmlwidget-41a1b0fe52767b8e30fd" style="width:504px;height:504px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-41a1b0fe52767b8e30fd">{"x":{"visdat":{"3c1c36cc6185":["function () ","plotlyVisDat"]},"cur_data":"3c1c36cc6185","attrs":{"3c1c36cc6185":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"frame":{},"type":"scatter","mode":"markers","symbol":{},"marker":{"color":{},"size":{},"line":{"color":{},"width":3}},"inherit":true}},"layout":{"width":1000,"height":500,"margin":{"b":10,"l":50,"t":50,"r":30,"pad":4},"xaxis":{"domain":[0,1],"automargin":true,"title":"","showgrid":false,"zeroline":false,"showline":false,"showticklabels":false,"range":[-0.04,0.53]},"yaxis":{"domain":[0,1],"automargin":true,"title":"","showgrid":false,"zeroline":false,"showline":false,"showticklabels":false,"range":[-0.05,0.54]},"plot_bgcolor":"rgba(0, 0, 0, 0)","paper_bgcolor":"rgba(0, 0, 0, 0)","autosize":false,"hovermode":"closest","showlegend":false,"sliders":[],"updatemenus":[{"type":"buttons","direction":"right","showactive":false,"y":0,"x":0,"yanchor":"top","xanchor":"right","pad":{"t":60,"r":5},"buttons":[{"label":"Play","method":"animate","args":[null,{"fromcurrent":true,"mode":"immediate","transition":{"duration":1300,"easing":"linear"},"frame":{"duration":1500,"redraw":false}}]}]}]},"source":"A","config":{"showSendToCloud":false,"displayModeBar":false},"data":[{"x":[0.258,-0.009,0.498,0.129,0.36,0.222,0.342,0.489,0.138,-0.018,0.138,0.369,0,0.489,0.258,0.018,0.351,0.489,0.12,0.222],"y":[0.025,0.04,0.075,0.025,0.04,0.21,0.2,0.19,0.2,0.2,0.325,0.34,0.36,0.375,0.375,0.49,0.5,0.5,0.5,0.525],"frame":"1","type":"scatter","mode":"markers","marker":{"color":["#9565C2","#C2679A","#EDE266","#C2679A","#9565C2","#C2679A","#C2679A","#EDE266","#9565C2","#C2679A","#C2679A","#9565C2","#EDE266","#EDE266","#EDE266","#C2679A","#C2679A","#C2679A","#9565C2","#C2679A"],"symbol":["triangle-up","circle","square","circle","square","square","triangle-up","circle","square","square","square","triangle-up","circle","triangle-up","triangle-up","circle","triangle-up","square","circle","square"],"size":[35,45,25,45,45,25,25,25,35,45,45,45,45,35,35,45,25,35,25,45],"line":{"color":["#5601A4","#BF3984","#FCCE25","#BF3984","#5601A4","#BF3984","#BF3984","#FCCE25","#5601A4","#BF3984","#BF3984","#5601A4","#FCCE25","#FCCE25","#FCCE25","#BF3984","#BF3984","#BF3984","#5601A4","#BF3984"],"width":3}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","visible":true}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"frames":[{"name":"1","data":[{"x":[0.258,-0.009,0.498,0.129,0.36,0.222,0.342,0.489,0.138,-0.018,0.138,0.369,0,0.489,0.258,0.018,0.351,0.489,0.12,0.222],"y":[0.025,0.04,0.075,0.025,0.04,0.21,0.2,0.19,0.2,0.2,0.325,0.34,0.36,0.375,0.375,0.49,0.5,0.5,0.5,0.525],"frame":"1","type":"scatter","mode":"markers","marker":{"color":["#9565C2","#C2679A","#EDE266","#C2679A","#9565C2","#C2679A","#C2679A","#EDE266","#9565C2","#C2679A","#C2679A","#9565C2","#EDE266","#EDE266","#EDE266","#C2679A","#C2679A","#C2679A","#9565C2","#C2679A"],"symbol":["triangle-up","circle","square","circle","square","square","triangle-up","circle","square","square","square","triangle-up","circle","triangle-up","triangle-up","circle","triangle-up","square","circle","square"],"size":[35,45,25,45,45,25,25,25,35,45,45,45,45,35,35,45,25,35,25,45],"line":{"color":["#5601A4","#BF3984","#FCCE25","#BF3984","#5601A4","#BF3984","#BF3984","#FCCE25","#5601A4","#BF3984","#BF3984","#5601A4","#FCCE25","#FCCE25","#FCCE25","#BF3984","#BF3984","#BF3984","#5601A4","#BF3984"],"width":3}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","visible":true}],"traces":[0]},{"name":"2","data":[{"x":[0.258,-0.009,0.498,0.129,0.36,0.222,0.342,0.489,0.138,-0.018,0.138,0.369,0,0.489,0.258,0.018,0.351,0.489,0.12,0.222],"y":[0.025,0.04,0.075,0.025,0.04,0.21,0.2,0.19,0.2,0.2,0.325,0.34,0.36,0.375,0.375,0.49,0.5,0.5,0.5,0.525],"frame":"2","type":"scatter","mode":"markers","marker":{"color":["#BCBABA","#FF5582","#BCBABA","#FF5582","#BCBABA","#BCBABA","#BCBABA","#FF5582","#BCBABA","#BCBABA","#BCBABA","#BCBABA","#FF5582","#BCBABA","#BCBABA","#FF5582","#BCBABA","#BCBABA","#FF5582","#BCBABA"],"symbol":["triangle-up","circle","square","circle","square","square","triangle-up","circle","square","square","square","triangle-up","circle","triangle-up","triangle-up","circle","triangle-up","square","circle","square"],"size":[35,45,25,45,45,25,25,25,35,45,45,45,45,35,35,45,25,35,25,45],"line":{"color":["#9E9D9D","#FF1654","#9E9D9D","#FF1654","#9E9D9D","#9E9D9D","#9E9D9D","#FF1654","#9E9D9D","#9E9D9D","#9E9D9D","#9E9D9D","#FF1654","#9E9D9D","#9E9D9D","#FF1654","#9E9D9D","#9E9D9D","#FF1654","#9E9D9D"],"width":3}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","visible":true}],"traces":[0]},{"name":"3","data":[{"x":[0.258,-0.009,0.498,0.129,0.36,0.222,0.342,0.489,0.138,-0.018,0.138,0.369,0,0.489,0.258,0.018,0.351,0.489,0.12,0.222],"y":[0.025,0.04,0.075,0.025,0.04,0.21,0.2,0.19,0.2,0.2,0.325,0.34,0.36,0.375,0.375,0.49,0.5,0.5,0.5,0.525],"frame":"3","type":"scatter","mode":"markers","marker":{"color":["#BCBABA","#FF5582","#BCBABA","#FF5582","#BCBABA","#BCBABA","#BCBABA","#FF5582","#BCBABA","#BCBABA","#BCBABA","#BCBABA","#FF5582","#BCBABA","#BCBABA","#FF5582","#BCBABA","#BCBABA","#FF5582","#BCBABA"],"symbol":["triangle-up","circle","square","circle","square","square","triangle-up","circle","square","square","square","triangle-up","circle","triangle-up","triangle-up","circle","triangle-up","square","circle","square"],"size":[35,45,25,45,45,25,25,25,35,45,45,45,45,35,35,45,25,35,25,45],"line":{"color":["#9E9D9D","#FF1654","#9E9D9D","#FF1654","#9E9D9D","#9E9D9D","#9E9D9D","#FF1654","#9E9D9D","#9E9D9D","#9E9D9D","#9E9D9D","#FF1654","#9E9D9D","#9E9D9D","#FF1654","#9E9D9D","#9E9D9D","#FF1654","#9E9D9D"],"width":3}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","visible":true}],"traces":[0]},{"name":"4","data":[{"x":[0.106,0.5,0.002,0.34,0.163,0.051,0.22,0.43,0.161,-0.004,0.106,0.222,0.5,0.051,0.07,0.35,0,0.14,0.42,0.21],"y":[0.165,0.266,0.165,0.28,0.135,0.15,0.15,0.28,0.27,0.27,0.27,0.27,0.38,0.285,0.385,0.38,0.415,0.385,0.366,0.385],"frame":"4","type":"scatter","mode":"markers","marker":{"color":["#BCBABA","#FF5582","#BCBABA","#FF5582","#BCBABA","#BCBABA","#BCBABA","#FF5582","#BCBABA","#BCBABA","#BCBABA","#BCBABA","#FF5582","#BCBABA","#BCBABA","#FF5582","#BCBABA","#BCBABA","#FF5582","#BCBABA"],"symbol":["triangle-up","circle","square","circle","square","square","triangle-up","circle","square","square","square","triangle-up","circle","triangle-up","triangle-up","circle","triangle-up","square","circle","square"],"size":[35,45,25,45,45,25,25,25,35,45,45,45,45,35,35,45,25,35,25,45],"line":{"color":["#9E9D9D","#FF1654","#9E9D9D","#FF1654","#9E9D9D","#9E9D9D","#9E9D9D","#FF1654","#9E9D9D","#9E9D9D","#9E9D9D","#9E9D9D","#FF1654","#9E9D9D","#9E9D9D","#FF1654","#9E9D9D","#9E9D9D","#FF1654","#9E9D9D"],"width":3}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","visible":true}],"traces":[0]}],"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>

---
# The power of randomization

- One way to make sure the ignorability assumption holds, is to do it by design:

.box-6[Randomize the assignment of Z]

i.e. Some units will **.darkorange[randomly]** be chosen to be in the treatment group and others to be in the control group.

.box-4t[What does randomization buy us?]

---
# The power of randomization

- One way to make sure the ignorability assumption holds, is to do it by design:

.box-6[Randomize the assignment of Z]

i.e. Some units will **.darkorange[randomly]** be chosen to be in the treatment group and others to be in the control group.

.box-4t[What does randomization buy us?]

.box-3t[No (systematic) selection on observables OR unobservables]


---
# Randomization of z

<div id="htmlwidget-bc001841e90ff42a1ed5" style="width:504px;height:504px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-bc001841e90ff42a1ed5">{"x":{"visdat":{"3c1c2c914a05":["function () ","plotlyVisDat"]},"cur_data":"3c1c2c914a05","attrs":{"3c1c2c914a05":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"frame":{},"type":"scatter","mode":"markers","symbol":{},"marker":{"color":{},"size":{},"line":{"color":{},"width":3}},"inherit":true}},"layout":{"width":1000,"height":500,"margin":{"b":10,"l":50,"t":50,"r":30,"pad":4},"xaxis":{"domain":[0,1],"automargin":true,"title":"","showgrid":false,"zeroline":false,"showline":false,"showticklabels":false,"range":[-0.04,0.53]},"yaxis":{"domain":[0,1],"automargin":true,"title":"","showgrid":false,"zeroline":false,"showline":false,"showticklabels":false,"range":[-0.01,0.56]},"plot_bgcolor":"rgba(0, 0, 0, 0)","paper_bgcolor":"rgba(0, 0, 0, 0)","autosize":false,"hovermode":"closest","showlegend":false,"sliders":[],"updatemenus":[{"type":"buttons","direction":"right","showactive":false,"y":0,"x":0,"yanchor":"top","xanchor":"right","pad":{"t":60,"r":5},"buttons":[{"label":"Play","method":"animate","args":[null,{"fromcurrent":true,"mode":"immediate","transition":{"duration":1300,"easing":"linear"},"frame":{"duration":1500,"redraw":false}}]}],"visible":true}]},"source":"A","config":{"showSendToCloud":false,"displayModeBar":false},"data":[{"x":[0.378,0,0.24,0.48,0.111,0.129,0.342,-0.009,0.489,0.249,0.378,0.471,-0.018,0.249,0.102,0.369,0.018,0.231,0.48,0.102],"y":[0.04,0.05,0.04,0.05,0.05,0.19,0.2,0.175,0.19,0.225,0.34,0.325,0.325,0.325,0.325,0.525,0.49,0.525,0.49,0.5],"frame":"1","type":"scatter","mode":"markers","marker":{"color":["#EDE266","#EDE266","#EDE266","#C2679A","#C2679A","#EDE266","#9565C2","#C2679A","#9565C2","#EDE266","#EDE266","#EDE266","#EDE266","#C2679A","#C2679A","#EDE266","#9565C2","#C2679A","#9565C2","#EDE266"],"symbol":["circle","triangle-up","square","triangle-up","circle","triangle-up","triangle-up","square","circle","triangle-up","circle","triangle-up","square","triangle-up","circle","triangle-up","triangle-up","square","circle","triangle-up"],"size":[35,45,25,45,45,25,25,25,35,45,35,45,25,45,45,25,25,25,35,45],"line":{"color":["#FCCE25","#FCCE25","#FCCE25","#BF3984","#BF3984","#FCCE25","#5601A4","#BF3984","#5601A4","#FCCE25","#FCCE25","#FCCE25","#FCCE25","#BF3984","#BF3984","#FCCE25","#5601A4","#BF3984","#5601A4","#FCCE25"],"width":3}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","visible":true}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"frames":[{"name":"1","data":[{"x":[0.378,0,0.24,0.48,0.111,0.129,0.342,-0.009,0.489,0.249,0.378,0.471,-0.018,0.249,0.102,0.369,0.018,0.231,0.48,0.102],"y":[0.04,0.05,0.04,0.05,0.05,0.19,0.2,0.175,0.19,0.225,0.34,0.325,0.325,0.325,0.325,0.525,0.49,0.525,0.49,0.5],"frame":"1","type":"scatter","mode":"markers","marker":{"color":["#EDE266","#EDE266","#EDE266","#C2679A","#C2679A","#EDE266","#9565C2","#C2679A","#9565C2","#EDE266","#EDE266","#EDE266","#EDE266","#C2679A","#C2679A","#EDE266","#9565C2","#C2679A","#9565C2","#EDE266"],"symbol":["circle","triangle-up","square","triangle-up","circle","triangle-up","triangle-up","square","circle","triangle-up","circle","triangle-up","square","triangle-up","circle","triangle-up","triangle-up","square","circle","triangle-up"],"size":[35,45,25,45,45,25,25,25,35,45,35,45,25,45,45,25,25,25,35,45],"line":{"color":["#FCCE25","#FCCE25","#FCCE25","#BF3984","#BF3984","#FCCE25","#5601A4","#BF3984","#5601A4","#FCCE25","#FCCE25","#FCCE25","#FCCE25","#BF3984","#BF3984","#FCCE25","#5601A4","#BF3984","#5601A4","#FCCE25"],"width":3}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","visible":true}],"traces":[0]},{"name":"2","data":[{"x":[0.006,0.076,0.134,0.006,0.146,0.064,0,0.186,0.12,0.066,0.405,0.445,0.5,0.345,0.47,0.35,0.415,0.35,0.41,0.475],"y":[0.2,0.18,0.19,0.28,0.29,0.29,0.39,0.4,0.4,0.4,0.22,0.2,0.2,0.2,0.3,0.28,0.3,0.4,0.38,0.41],"frame":"2","type":"scatter","mode":"markers","marker":{"color":["#EDE266","#EDE266","#EDE266","#C2679A","#C2679A","#EDE266","#9565C2","#C2679A","#9565C2","#EDE266","#EDE266","#EDE266","#EDE266","#C2679A","#C2679A","#EDE266","#9565C2","#C2679A","#9565C2","#EDE266"],"symbol":["circle","triangle-up","square","triangle-up","circle","triangle-up","triangle-up","square","circle","triangle-up","circle","triangle-up","square","triangle-up","circle","triangle-up","triangle-up","square","circle","triangle-up"],"size":[35,45,25,45,45,25,25,25,35,45,35,45,25,45,45,25,25,25,35,45],"line":{"color":["#FCCE25","#FCCE25","#FCCE25","#BF3984","#BF3984","#FCCE25","#5601A4","#BF3984","#5601A4","#FCCE25","#FCCE25","#FCCE25","#FCCE25","#BF3984","#BF3984","#FCCE25","#5601A4","#BF3984","#5601A4","#FCCE25"],"width":3}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","visible":true}],"traces":[0]},{"name":"3","data":[{"x":[0.006,0.076,0.134,0.006,0.146,0.064,0,0.186,0.12,0.066,0.405,0.445,0.5,0.345,0.47,0.35,0.415,0.35,0.41,0.475],"y":[0.2,0.18,0.19,0.28,0.29,0.29,0.39,0.4,0.4,0.4,0.22,0.2,0.2,0.2,0.3,0.28,0.3,0.4,0.38,0.41],"frame":"3","type":"scatter","mode":"markers","marker":{"color":["#EDE266","#EDE266","#EDE266","#C2679A","#C2679A","#EDE266","#9565C2","#C2679A","#9565C2","#EDE266","#EDE266","#EDE266","#EDE266","#C2679A","#C2679A","#EDE266","#9565C2","#C2679A","#9565C2","#EDE266"],"symbol":["circle","triangle-up","square","triangle-up","circle","triangle-up","triangle-up","square","circle","triangle-up","circle","triangle-up","square","triangle-up","circle","triangle-up","triangle-up","square","circle","triangle-up"],"size":[35,45,25,45,45,25,25,25,35,45,35,45,25,45,45,25,25,25,35,45],"line":{"color":["#FCCE25","#FCCE25","#FCCE25","#BF3984","#BF3984","#FCCE25","#5601A4","#BF3984","#5601A4","#FCCE25","#FCCE25","#FCCE25","#FCCE25","#BF3984","#BF3984","#FCCE25","#5601A4","#BF3984","#5601A4","#FCCE25"],"width":3}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","visible":true}],"traces":[0]},{"name":"4","data":[{"x":[0.006,0.076,0.134,0.006,0.146,0.064,0,0.186,0.12,0.066,0.405,0.445,0.5,0.345,0.47,0.35,0.415,0.35,0.41,0.475],"y":[0.2,0.18,0.19,0.28,0.29,0.29,0.39,0.4,0.4,0.4,0.22,0.2,0.2,0.2,0.3,0.28,0.3,0.4,0.38,0.41],"frame":"4","type":"scatter","mode":"markers","marker":{"color":["#BCBABA","#BCBABA","#BCBABA","#BCBABA","#BCBABA","#BCBABA","#BCBABA","#BCBABA","#BCBABA","#BCBABA","#FF5582","#FF5582","#FF5582","#FF5582","#FF5582","#FF5582","#FF5582","#FF5582","#FF5582","#FF5582"],"symbol":["circle","triangle-up","square","triangle-up","circle","triangle-up","triangle-up","square","circle","triangle-up","circle","triangle-up","square","triangle-up","circle","triangle-up","triangle-up","square","circle","triangle-up"],"size":[35,45,25,45,45,25,25,25,35,45,35,45,25,45,45,25,25,25,35,45],"line":{"color":["#9E9D9D","#9E9D9D","#9E9D9D","#9E9D9D","#9E9D9D","#9E9D9D","#9E9D9D","#9E9D9D","#9E9D9D","#9E9D9D","#FF1654","#FF1654","#FF1654","#FF1654","#FF1654","#FF1654","#FF1654","#FF1654","#FF1654","#FF1654"],"width":3}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","visible":true}],"traces":[0]}],"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>

---
# Observational Causal Graph

.center[
![:scale 70%](https://github.com/maibennett/sta235/raw/main/exampleSite/content/Classes/Week4/1_RCT/images/obs_dag.png)
]

---
# Experimental Causal Graph

.center[
![:scale 70%](https://github.com/maibennett/sta235/raw/main/exampleSite/content/Classes/Week4/1_RCT/images/experimental_dag.png)
]

---
# If I randomize treatment allocation...

.center2[
.box-3LA[Can the treatment be potentially correlated with a confounder?]]

---
# Just by chance!

.center[
![:scale 100%](https://github.com/maibennett/sta235/raw/main/exampleSite/content/Classes/Week4/1_RCT/images/nicholas_cage.png)]

---
# RCTs: The Gold Standard

.pull-left[
.center[
![:scale 80%](https://github.com/maibennett/sta235/raw/main/exampleSite/content/Classes/Week4/1_RCT/images/nobel.png)
]
]

.pull-right[
.center[
![:scale 90%](https://github.com/maibennett/sta235/raw/main/exampleSite/content/Classes/Week4/1_RCT/images/nobel2.png)
]
]

---
# How do we randomize?


---
# How do we randomize?


.box-5[Coin flip*]


.center[
![:scale 10%](https://github.com/maibennett/sta235/raw/main/exampleSite/content/Classes/Week4/1_RCT/images/coin.png)]

---
# How do we randomize?


.box-5[Coin flip*]

E.g., in `R`:

.pull-left[

```r
id &lt;- seq(1,1000)

set.seed(100)

treat_id &lt;- sample(id, length(id)*0.5)
control_id &lt;- id[!(id %in% treat_id)]
```
]

---
# How do we randomize?

.box-5[Coin flip*]

E.g., in `R`:

.pull-left[

```r
id &lt;- seq(1,1000)

*set.seed(100)

treat_id &lt;- sample(id, length(id)*0.5)
control_id &lt;- id[!(id %in% treat_id)]
```
]

---
# How do we randomize?

.box-5[Coin flip*]

E.g., in `R`:

.pull-left[

```r
id &lt;- seq(1,1000)

set.seed(100)

*treat_id &lt;- sample(id, length(id)*0.5)
control_id &lt;- id[!(id %in% treat_id)]
```
]

---
# How do we randomize?

.box-5[Coin flip*]

E.g., in `R`:

.pull-left[

```r
id &lt;- seq(1,1000)

set.seed(100)

treat_id &lt;- sample(id, length(id)*0.5)
*control_id &lt;- id[!(id %in% treat_id)]
```
]

---
# How do we randomize?

.box-5[Coin flip*]

E.g., in `R`:

.pull-left[

```r
id &lt;- seq(1,1000)

set.seed(100)

treat_id &lt;- sample(id, length(id)*0.5)
control_id &lt;- id[!(id %in% treat_id)]
```
]

.pull-right[

```r
*z &lt;- rep(0, length(id))
*z[treat_id] &lt;- 1

d &lt;- data.frame("id" = id,"z" = z)

head(d)
```

```
##   id z
## 1  1 1
## 2  2 1
## 3  3 0
## 4  4 1
## 5  5 0
## 6  6 0
```
]

---
# How would you randomize for more treatments?

---
# How would you randomize for more treatments?

.pull-left[

```r
# One way

id &lt;- seq(1,1000)

set.seed(100)

types_treat &lt;- c(0,1,2)

*z &lt;- sample(types_treat, length(id),
*           replace = TRUE, prob = c(1/3,1/3,1/3))

table(z)
```

```
## z
##   0   1   2 
## 354 306 340
```
]


---
# How would you randomize for more treatments?

.pull-left[

```r
# One way

id &lt;- seq(1,1000)

set.seed(100)

types_treat &lt;- c(0,1,2)

z &lt;- sample(types_treat, length(id), 
            replace = TRUE, prob = c(1/3,1/3,1/3))

table(z)
```

```
## z
##   0   1   2 
## 354 306 340
```
]

.pull-right[

```r
# Another way

id &lt;- seq(1,1000)

set.seed(100)

*rand &lt;- runif(length(id))

id &lt;- id[order(rand)]

z &lt;- rep(c(0,1,2),1000/3 + 1)[1:length(id)]

table(z)
```

```
## z
##   0   1   2 
## 334 333 333
```
]

---
# How would you randomize for more treatments?

.pull-left[

```r
# One way

id &lt;- seq(1,1000)

set.seed(100)

types_treat &lt;- c(0,1,2)

z &lt;- sample(types_treat, length(id), 
            replace = TRUE, prob = c(1/3,1/3,1/3))

table(z)
```

```
## z
##   0   1   2 
## 354 306 340
```
]

.pull-right[

```r
# Another way

id &lt;- seq(1,1000)

set.seed(100)

rand &lt;- runif(length(id)) 

*id &lt;- id[order(rand)]

z &lt;- rep(c(0,1,2),1000/3 + 1)[1:length(id)]

table(z)
```

```
## z
##   0   1   2 
## 334 333 333
```
]
---
.center2[
.box-3LA[How do we check that randomization was done correctly?]
]

---
# Checking for balance

.small[

```r
library(designmatch)

d &lt;- read.csv("https://raw.githubusercontent.com/maibennett/sta235/main/exampleSite/content/Classes/Week4/1_RCT/data/covariates_example.csv")

head (round(d,3))
```

```
##   id z     x1     x2     x3     x4     x5     x6     x7     x8     x9    x10
## 1  1 1 -0.626 -0.897 -0.962  0.217 -0.841  0.270  2.287 -0.085 -0.767  0.019
## 2  2 1  0.184  0.185 -0.293 -0.542  1.384 -0.630 -1.197  0.840 -0.816 -0.184
## 3  3 0 -0.836  1.588  0.259  0.891 -1.255  0.869 -0.694 -0.463 -0.142 -1.371
## 4  4 1  1.595 -1.130 -1.152  0.596  0.070  1.727 -0.412 -0.551 -0.278 -0.599
## 5  5 0  0.330 -0.080  0.196  1.636  1.711  0.024 -0.971  0.736  0.436  0.295
## 6  6 0 -0.820  0.132  0.030  0.689 -0.603  0.368 -0.947 -0.108 -1.187  0.390
##      x11    x12    x13    x14    x15    x16    x17    x18    x19    x20
## 1 -0.591 -1.481  0.554 -0.662  0.259  0.476 -1.015  0.926 -1.189  1.163
## 2  0.027  1.577 -0.280  1.719  1.831 -0.125 -0.080  1.823  0.389 -0.586
## 3 -1.517 -0.957  1.775  2.122 -0.340  1.096 -0.233 -1.611 -0.344  1.785
## 4 -1.363 -0.920  0.187  1.497  0.897 -1.444 -0.817 -0.285 -0.548 -1.333
## 5  1.178 -1.998  1.143 -0.036  0.488  1.148  0.772 -0.342  0.981 -0.447
## 6 -0.934 -0.272  0.416  1.232 -1.255 -0.468 -0.166  0.366 -0.237  0.570
```

```r
names_covs &lt;- paste0("x",seq(1,20))
```
]
---
# Checking for balance

.pull-left[
.small[

```r
meantab(d[,names_covs], d$z, which(d$z==1), which(d$z==0))
```

```
##     Mis   Min  Max Mean T Mean C Std Dif P-val
## x1    0 -3.01 3.81   0.04  -0.07    0.11  0.09
## x2    0 -2.72 3.01   0.06   0.06    0.00  0.98
## x3    0 -3.06 3.52   0.01   0.01    0.00  0.99
## x4    0 -2.84 3.17  -0.04  -0.03    0.00  0.96
## x5    0 -3.50 3.40   0.01   0.03   -0.02  0.77
## x6    0 -4.92 3.24   0.03  -0.08    0.12  0.07
## x7    0 -2.97 2.97  -0.03   0.03   -0.06  0.31
## x8    0 -3.28 2.98  -0.07  -0.02   -0.05  0.45
## x9    0 -3.04 2.76   0.01   0.00    0.02  0.77
## x10   0 -3.01 3.54   0.03  -0.01    0.04  0.55
## x11   0 -3.28 3.70  -0.02   0.04   -0.06  0.36
## x12   0 -3.05 3.11  -0.04  -0.01   -0.03  0.69
## x13   0 -2.84 3.59  -0.01   0.01   -0.02  0.71
## x14   0 -2.96 2.92  -0.02  -0.04    0.01  0.82
## x15   0 -4.21 3.44   0.04   0.04    0.00  0.98
## x16   0 -3.33 3.47   0.04   0.04    0.00  0.95
## x17   0 -3.56 3.94   0.05  -0.01    0.06  0.33
## x18   0 -3.74 3.17  -0.08   0.00   -0.08  0.20
## x19   0 -3.03 2.87   0.02  -0.03    0.04  0.49
## x20   0 -3.00 2.93  -0.03   0.00   -0.04  0.58
```
]]
.pull-right[
- **.darkorange[Columns of interest]**:

  - Mean T: Avg. for treat. group
  
  - Mean C: Avg. for control group
  
  - Std. Dif: Difference T-C (in SD)
  
  - P-val: Whether diff is significant
]

---
# Checking for balance

.pull-left[
.small[

```r
meantab(d[,names_covs], d$z, which(d$z==1), which(d$z==0))
```

```
##     Mis   Min  Max Mean T Mean C Std Dif P-val
*## x1    0 -3.01 3.81   0.04  -0.07    0.11  0.09
## x2    0 -2.72 3.01   0.06   0.06    0.00  0.98
## x3    0 -3.06 3.52   0.01   0.01    0.00  0.99
## x4    0 -2.84 3.17  -0.04  -0.03    0.00  0.96
## x5    0 -3.50 3.40   0.01   0.03   -0.02  0.77
*## x6    0 -4.92 3.24   0.03  -0.08    0.12  0.07
## x7    0 -2.97 2.97  -0.03   0.03   -0.06  0.31
## x8    0 -3.28 2.98  -0.07  -0.02   -0.05  0.45
## x9    0 -3.04 2.76   0.01   0.00    0.02  0.77
## x10   0 -3.01 3.54   0.03  -0.01    0.04  0.55
## x11   0 -3.28 3.70  -0.02   0.04   -0.06  0.36
## x12   0 -3.05 3.11  -0.04  -0.01   -0.03  0.69
## x13   0 -2.84 3.59  -0.01   0.01   -0.02  0.71
## x14   0 -2.96 2.92  -0.02  -0.04    0.01  0.82
## x15   0 -4.21 3.44   0.04   0.04    0.00  0.98
## x16   0 -3.33 3.47   0.04   0.04    0.00  0.95
## x17   0 -3.56 3.94   0.05  -0.01    0.06  0.33
## x18   0 -3.74 3.17  -0.08   0.00   -0.08  0.20
## x19   0 -3.03 2.87   0.02  -0.03    0.04  0.49
## x20   0 -3.00 2.93  -0.03   0.00   -0.04  0.58
```
]]
.pull-right[
**.darkorange[Did the randomization work?]**

**.darkorange[Why are there significant differences?]**
]

---
.center2[.box-6LA[Randomization assures balance *in expectation*]]

---
.center2[.box-3LA[Let's go to R]]

---
# Simulations: Difference between T and C for X1

- 100 random assignments for `\(Z\)`

.center[
![:scale 50%](https://github.com/maibennett/sta235/raw/main/exampleSite/content/Classes/Week4/1_RCT/images/sim_100.png)
]

---
# Simulations: Difference between T and C for X1

- 1,000 random assignments for `\(Z\)`

.center[
![:scale 50%](https://github.com/maibennett/sta235/raw/main/exampleSite/content/Classes/Week4/1_RCT/images/sim_1k.png)
]

---
# Simulations: Difference between T and C for X1

- 100,000 random assignments for `\(Z\)`

.center[
![:scale 50%](https://github.com/maibennett/sta235/raw/main/exampleSite/content/Classes/Week4/1_RCT/images/sim_100k.png)
]

---
# Can we ensure balance?

- In RCTs, in general, you can't ensure balance on all covariates.

- But you can **.darkorange[stratify]**!
--

- Stratification means dividing your data into different stratas or groups *S*, based on one or more covariates.

- Then, you randomize in the same way *within strata*.

---
# Randomization of treatment

.center[
![:scale 80%](https://github.com/maibennett/sta235/raw/main/exampleSite/content/Classes/Week4/1_RCT/images/study1.png)
]

---
# Randomization of treatment with no strata

.center[
![:scale 80%](https://github.com/maibennett/sta235/raw/main/exampleSite/content/Classes/Week4/1_RCT/images/study2.png)
]

---
# Randomization of treatment with strata

.center[
![:scale 80%](https://github.com/maibennett/sta235/raw/main/exampleSite/content/Classes/Week4/1_RCT/images/study3.png)
]

---
background-position: 50% 50%
class: left, bottom, inverse
.big[
RCTs in Practice
]

---
# How to analyze RCTs?


---
# How to analyze RCTs?

.box-7LA[Easy! (Statistically speaking)]

---
# How to analyze RCTs?

.box-7LA[Easy! (Statistically speaking)]
&lt;br&gt;
&lt;br&gt;
.box-6tL[1) Check for balance]
&lt;br&gt;

---
# How to analyze RCTs?

.box-7LA[Easy! (Statistically speaking)]
&lt;br&gt;
&lt;br&gt;
.box-6tL[1) Check for balance]
&lt;br&gt;
.box-6tL[2) Calculate difference in sample means between treatment and control group]

---
# Let's look at some data

.pull-left[
- "Get out the Vote" Large-Scale Mobilization experiment (Arceneaux, Gerber, and Green, 2006)
  
  - "Households containing one or two registered voters where **.darkorange[randomly assigned]** to treatment or control groups"
  
  - Treatment: GOTV phone calls
  
  - Stratified RCT: Two states divided into competitive and noncompetitive 
]
.pull-right[
![:scale 100%](https://github.com/maibennett/sta235/raw/main/exampleSite/content/Classes/Week4/1_RCT/images/vote.jpg)
]

---
# Checking for balance

.center2[
.box-5LA[Let's go to R]
]

---
# Checking for balance

.small[
<div class="tab">
<div class="title">
<h3>Balance Table by Stratum</h3>
</div>
<div id="htmlwidget-6d6f6146f97666dc1e36" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-6d6f6146f97666dc1e36">{"x":{"tag":{"name":"Reactable","attribs":{"data":{".rownames":["female2","fem_miss","age","newreg","persons","contact","vote98","vote00"],"V1":[0.552,0,52.157,0.117,1.496,0,0.231,0.564],"V2":[0.546,0,51.977,0.116,1.497,0.369,0.227,0.567],"V3":[0.541,0,50.81,0.133,1.513,0,0.258,0.595],"V4":[0.535,0,50.862,0.134,1.518,0.388,0.259,0.593],"V5":[0.549,0.026,55.795,0.048,1.539,0,0.572,0.734],"V6":[0.545,0.025,55.782,0.049,1.538,0.461,0.574,0.732],"V7":[0.543,0.022,53.481,0.048,1.529,0,0.599,0.781],"V8":[0.541,0.021,53.464,0.046,1.533,0.452,0.594,0.78]},"columns":[{"accessor":".rownames","name":"","type":"character","align":"center","sortable":false,"filterable":false},{"accessor":"V1","name":"Treat","type":"numeric","align":"center"},{"accessor":"V2","name":"Control","type":"numeric","align":"center","style":{"borderRight":"1px solid rgba(0, 0, 0, 0.1)"}},{"accessor":"V3","name":"Treat","type":"numeric","align":"center"},{"accessor":"V4","name":"Control","type":"numeric","align":"center","style":{"borderRight":"3px solid rgba(0, 0, 0, 0.1)"}},{"accessor":"V5","name":"Treat","type":"numeric","align":"center"},{"accessor":"V6","name":"Control","type":"numeric","align":"center","style":{"borderRight":"1px solid rgba(0, 0, 0, 0.1)"}},{"accessor":"V7","name":"Treat","type":"numeric","align":"center"},{"accessor":"V8","name":"Control","type":"numeric","align":"center"}],"columnGroups":[{"name":"Non-competitive","columns":["V1","V2"]},{"name":"Competitive","columns":["V3","V4"]},{"name":"Non-competitive","columns":["V5","V6"]},{"name":"Competitive","columns":["V7","V8"]},{"name":"State 1","columns":["V1","V2","V3","V4"]}],"defaultPageSize":10,"paginationType":"numbers","showPageInfo":true,"minRows":1,"highlight":true,"striped":true,"style":{"fontFamily":"Fira Sans, sans-serif"},"dataKey":"0b0b5a12d5ba2571ccc96269b61b6041","key":"0b0b5a12d5ba2571ccc96269b61b6041"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
]

---
# Estimating the effect

- Depending on the design, usually you can **.darkorange[compare group means]** or fit a **.darkorange[simple regression]**

--

`$$\frac{1}{N_T}\sum_{i\in T}Y_i - \frac{1}{N_C}\sum_{i\in C}Y_i$$`

`$$Y_i = \beta_0 + \beta_1 Z_i + \varepsilon_i$$`

--

.box-4[How do we incorporate stratification here?]

---
# Estimating the effect

- In stratified RCTs, we need to consider the strata!

--

- Run a regression with *fixed effects by strata*

.box-6t[$$Y_i = \beta_0 + \beta_1 Z_i + \gamma_s + \varepsilon_i$$]


---
# Estimating the effect


.small[

```r
library(estimatr)

d_s1$strata &lt;- interaction(d_s1$state, d_s1$competiv)

summary(estimatr::lm_robust(vote02 ~ treat_real + strata, data = d_s1))
```

```
## 
## Call:
## estimatr::lm_robust(formula = vote02 ~ treat_real + strata, data = d_s1)
## 
## Standard error type:  HC2 
## 
## Coefficients:
##             Estimate Std. Error   t value Pr(&gt;|t|) CI Lower CI Upper      DF
## (Intercept) 0.509915  0.0004633 1100.6000   0.0000  0.50901 0.510823 1905315
## treat_real  0.001499  0.0020709    0.7237   0.4693 -0.00256 0.005557 1905315
## strata1.1   0.085625  0.0016372   52.2989   0.0000  0.08242 0.088834 1905315
## strata0.2   0.049105  0.0009801   50.1034   0.0000  0.04718 0.051026 1905315
## strata1.2   0.146435  0.0009803  149.3733   0.0000  0.14451 0.148357 1905315
## 
## Multiple R-squared:  0.01172 ,	Adjusted R-squared:  0.01172 
## F-statistic:  5937 on 4 and 1905315 DF,  p-value: &lt; 2.2e-16
```
]

---
# Estimating the effect

- One important thing to note in the previous analysis is that **.darkorange[assignment to treatment]** `\(\neq\)` **.darkorange[contact]**


```r
table(d_s1$treat_real, d_s1$contact)
```

```
##    
##           0       1
##   0 1845348       0
##   1   34929   25043
```

--

.box-5[Does this affect the internal validity of the study?]

---
background-position: 50% 50%
class: left, bottom, inverse
.big[
When we assume...
]

---
# Other assumptions

.pull-left[
- We already talked about the **.darkorange[ignorability assumption]**


- **.darkorange[Stable Unit Treatment Value Assumption (SUTVA)]**:

  - No interference
  - No hidden variations of treatments
]

.pull-right[
.center[
![](https://media.giphy.com/media/xT5LMHsI58Q1ZpugPC/giphy.gif)]
]
---
# SUTVA: No interference

- *"The treatment applied to one unit does not affect the outcome for other units"*

--

- Imagine we have two individuals, 1 and 2:

  - `\(Z_1\)` and `\(Z_2\)` will be the treatment assignment for 1 and 2, respectively.
  
  - Under SUTVA:
  
  .box-3LA[$$(Y_2(0), Y_2(1)) \perp Z_1$$]
  

---
# SUTVA: No hidden variations of treatments

- *"An individual receiving an specific treatment level cannot receive different forms of that treatment."*

--

- Think about the headache example from last class:

  - Individual 1 gets a **.darkorange[new aspirin (aspirin +)]**
  - Individual 2 gets an **.darkorange[old aspirin (aspirin -)]**
  - Individual 3 doesn't get a pill
  
- If we label the treatments as `\(Z=0\)` (doesn't get an aspirin) and `\(Z=1\)` (gets an aspirin), **.darkorange[potential outcomes would change depending on whether they got *aspirin +* or *aspirin -*.]**



---
# When SUTVA hits the fan

.center2[
.box-7[When do you think SUTVA could fail?]
]
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
.bottom2[.lightgrey[h/t to @paul_gp]]

---
# When SUTVA hits the fan
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
.center[
.box-3[Network effects]
]
--
.center[
.box-5[General Equilibrium Effects]
]

---
# Network effects

- Also referred to as **.darkorange[spillovers]**

- Potential outcomes will depend on *who gets the treatment*

&lt;br&gt;
&lt;br&gt;
.box-2LA[Let's look at an example]

---
# Network effects

.center[
![:scale 80%](https://github.com/maibennett/sta235/raw/main/exampleSite/content/Classes/Week4/1_RCT/images/networks1.png)
]


---
# Network effects

.center[
![:scale 80%](https://github.com/maibennett/sta235/raw/main/exampleSite/content/Classes/Week4/1_RCT/images/networks2.png)
]

---
# Network effects

.center[
![:scale 80%](https://github.com/maibennett/sta235/raw/main/exampleSite/content/Classes/Week4/1_RCT/images/networks3.png)
]

---
# Network effects

.center[
![:scale 80%](https://github.com/maibennett/sta235/raw/main/exampleSite/content/Classes/Week4/1_RCT/images/networks4.png)
]

---
# Network effects

.center[
![:scale 80%](https://github.com/maibennett/sta235/raw/main/exampleSite/content/Classes/Week4/1_RCT/images/networks5.png)
]

---
# Network effects

.box-6LA[Can we do something about this?]
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
--

1. **.darkorange[Randomize at a higher level]** (e.g. neighborhood, school, etc. instead of at the individual level)

--

  - Note that you will have to **.darkorange[cluster your standard errors]**

--

2. **.darkorange[Model the network!]**

---
# General Equilibrium Effects

- Usually arise when you **.darkorange[scale up]** a program or intervention.

- Imagine you want to test the effect of providing information about employment and expected income to students to see whether it affect their choice of university and/or major.

--
&lt;br&gt;
&lt;br&gt;
.box-7LA[What could happen if you offer it to everyone?]

---
background-position: 50% 50%
class: left, bottom, inverse
.big[
Show me the power
]

---
# Statistical power

- **.darkorange[Statistical power]** refers to the probability that a test correctly rejects the null hypothesis `\(H_0\)`, when `\(H_0\)` is false.

  - It's related to sample size!

--

.box-6[Power = 1- Pr(Type II error)]

- **.darkorange[Type I error]**: Probability of rejecting the null hypothesis, when the null is true ($\alpha$).

- **.darkorange[Type II error]**: Probability of not rejecting the null hypothesis, when the null is false ($\beta$).

---
# Statistical power


.center[
![:scale 70%](https://github.com/maibennett/sta235/raw/main/exampleSite/content/Classes/Week4/1_RCT/images/type_1_errors.png)]


---
# Statistical power


.center[
![:scale 90%](https://github.com/maibennett/sta235/raw/main/exampleSite/content/Classes/Week4/1_RCT/images/type_2_errors.png)]



---
# Statistical power in pictures

&lt;img src="sp2021_sta235_6_RCT_files/figure-html/power_calc-1.svg" style="display: block; margin: auto;" /&gt;
---
#Statistical power and sample size
.box-2t[How big of a sample?]

--




.box-4t[A training program causes incomes to rise by $40]

.center.small[

|Person |Group     | Before | After  | Difference |
|:------|:---------|:------:|:------:|:----------:|
|295    |Control   | 122.09 | 219.04 |   96.95    |
|126    |Treatment | 205.60 | 199.84 |   -5.76    |
|400    |Control   | 133.25 | 120.40 |   -12.85   |
|94     |Treatment | 270.11 | 206.56 |   -63.54   |
|250    |Control   | 344.37 | 212.89 |  -131.49   |
|59     |Treatment | 312.41 | 268.06 |   -44.35   |
]

---
# Can I detect an effect?

.pull-left[
.center[
.box-5b[Enroll 10 participants]]

&lt;img src="sp2021_sta235_6_RCT_files/figure-html/power-small-1.png" width="100%" /&gt;

]

--

.pull-right[
.center[.box-5b[Enroll 200 participants]]

&lt;img src="sp2021_sta235_6_RCT_files/figure-html/power-big-1.png" width="100%" /&gt;

]


---
# What's the right sample size?

.box-6[Use a statistical power calculator to&lt;br&gt;make sure you can potentially detect an effect]

.center[
![:scale 50%](https://github.com/maibennett/sta235/raw/main/exampleSite/content/Classes/Week4/1_RCT/images/power-search.png)
]

--

.box-7[Or you can use simulations!]

---
# A quick note on randomization inference

- Previous power calculations work well on **.darkorange[larger samples]**.

- On smaller samples, usually we can't rely on the **.darkorange[central limit theorem]**.

--

.box-3[Randomization Inference]
&lt;br&gt;
&lt;br&gt;

.box-3t[What are the chances of something happening given all possible randomization scenarios?]

---
# The Lady Tasting Tea

- There's a lady in England that claims she can always know whether **.darkorange[tea or milk was poured first]** in a cup.

- So you decide to **.darkorange[test it]**.

--

.center[
![:scale 50%](https://github.com/maibennett/sta235/raw/main/exampleSite/content/Classes/Week4/1_RCT/images/cups.png)]

--
- This is only one of the random allocations you could have used. There are other **.darkorange[19 combinations]**!

  - Number of possible randomization allocations (or permutations): `\(n \choose k\)`
  
---
# The Lady Tasting Tea

.center[
![:scale 20%](https://github.com/maibennett/sta235/raw/main/exampleSite/content/Classes/Week4/1_RCT/images/cups.png)]

.small[  
<div class="tab">
<div class="title">
<h3>Possible Treatment Allocations</h3>
</div>
<div id="htmlwidget-5ccd2a04e6f01e06d7b1" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-5ccd2a04e6f01e06d7b1">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"cup 1":[1,1,1,1,1,1,1,1],"cup 2":[1,0,0,0,1,1,1,0],"cup 3":[1,1,0,0,0,0,0,1],"cup 4":[0,1,1,0,1,0,0,0],"cup 5":[0,0,1,1,0,1,0,1],"cup 6":[0,0,0,1,0,0,1,0]},"columns":[{"accessor":"cup 1","name":"cup 1","type":"numeric","align":"center"},{"accessor":"cup 2","name":"cup 2","type":"numeric","align":"center"},{"accessor":"cup 3","name":"cup 3","type":"numeric","align":"center"},{"accessor":"cup 4","name":"cup 4","type":"numeric","align":"center"},{"accessor":"cup 5","name":"cup 5","type":"numeric","align":"center"},{"accessor":"cup 6","name":"cup 6","type":"numeric","align":"center"}],"defaultPageSize":10,"paginationType":"numbers","showPageInfo":true,"minRows":1,"highlight":true,"striped":true,"style":{"fontFamily":"Fira Sans, sans-serif"},"theme":{"highlightColor":"rgba(248, 148, 65,0.3)"},"dataKey":"607fa7bdfa8a267fa2027532a2618f76","key":"607fa7bdfa8a267fa2027532a2618f76"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
]

---
# The Lady Tasting Tea

- If the woman is telling the truth, then she needs to pick out the 3 cups of tea with milk first.

--

.box-4[She does it!]

--

.box-4[What are the chances?]


---
# The Lady Tasting Tea

- If she was just guessing, she is equally likely to choose any of the **.darkorange[20 possibilities]** (because `\({6 \choose 3} = 20\)`).

- **.darkorange[Under the null hypothesis]**, the probability of her choosing `\(k\)` correct ones out of `\(n\)` cups is:
`$$Pr(Successes = k) = \frac{1}{Total \ Perm}{n \choose k} {n \choose n-k}$$`
--
.center[
![:scale 60%](https://github.com/maibennett/sta235/raw/main/exampleSite/content/Classes/Week4/1_RCT/images/combinations.png)]

.box-2[p-value = 0.05]


---
background-position: 50% 50%
class: left, bottom, inverse
.big[
Limitations and Potential Problems in Randomized Controlled Trials
]

---
# Generalizibility of RCTs

- External Validity vs Internal Validity:

  - **.darkorange[External validity]**: "The extent to which results can be generalized to other contexts or populations."
  
  - **.darkorange[Internal validity]**: "[T]he extent to which the observed results represent the truth in the population we are studying."

---
# External vs Internal Validity

.center[
![:scale 75%](https://github.com/maibennett/sta235/raw/main/exampleSite/content/Classes/Week4/1_RCT/images/validity.png)]

--
- Many times, RCTs use **.darkorange[convenience samples]**

---
# Noncompliance and Attrition

.box-5[Attrition]

.box-5t[Units fall out of your sample]

- **.darkorange[Can you give an example?]**

---
# Noncompliance and Attrition

.box-5[Attrition]

.box-5t[Units fall out of your sample]

.box-7[Noncompliance]

.box-7t[Units that where assigned to one group end up in another]

- **.darkorange[Example?]**

---
# Noncompliance and Attrition

- If **.darkorange[attrition]** is correlated with the treatment, we're in trouble.

--

.box-3LA[WHY?]

---
# Noncompliance and Attrition

- If **.darkorange[attrition]** is correlated with the treatment, we're in trouble.


.box-3LA[The ignorability assumption can break!]

---
# Noncompliance and Attrition

- If **.darkorange[attrition]** is correlated with the treatment, we're in trouble.

.box-3LA[The ignorability assumption can break!]

- **.darkorange[Noncompliance]** is a problem for identifying `\(ATE\)`.

  - E.g. Treatment *assingment* is random, but not necessarily the *take-up* of the treatment
  
--
  
  - Stuck with **.darkorange[Intention to Treat (ITT) effect]**.

---
# Other problems to look out for

1. **.darkorange[Hawthorne effects]**:

  - Effect that occurs when people behave differently because they are being watched

--

2. **.darkorange[John Henry effects]**:

  - Effect that occurs when the control group works harder because they were not assigned to treatment.


---
# Feasibility

.pull-left[
- RCTs can be **.darkorange[expensive]** and also **.darkorange[slow]**.

- Organizations might **.darkorange[not be willing to randomize]**.
]

.pull-right[
.center[
![:scale 90%](https://media.giphy.com/media/1xkMJIvxeKiDS/giphy.gif)]
]
---
# Getting around some issues

- **.darkorange[Staggered adoption]**: Eventually treat everyone, but at different times.

  - You can think about this when you have panel data.

- **.darkorange[Randomize in the bubble]**:

  - Not randomize everyone, but maybe those that are on the margin of receiving the treatment.
  
---
# Staggered adoption

.pull-left[
![](https://github.com/maibennett/sta235/raw/main/exampleSite/content/Classes/Week4/1_RCT/images/staggered1.png)
]

--

.pull-right[
![](https://github.com/maibennett/sta235/raw/main/exampleSite/content/Classes/Week4/1_RCT/images/staggered2.png)
]

---
# Staggered adoption

.pull-left[
![](https://github.com/maibennett/sta235/raw/main/exampleSite/content/Classes/Week4/1_RCT/images/staggered1.png)
]


.pull-right[
![](https://github.com/maibennett/sta235/raw/main/exampleSite/content/Classes/Week4/1_RCT/images/staggered3.png)
]

---
background-position: 50% 50%
class: left, bottom, inverse
.big[
A/B Testing
]

---
# A/B Testing

.pull-left[
.center[
![](https://media.giphy.com/media/LmNwrBhejkK9EFP504/giphy.gif)]
]

.pull-right[
- A/B testing is very popular right now to test the effect of **.darkorange[small changes]** in products on an outcome of interest.

- E.g. In web development, user would be exposed to **.darkorange[different versions of the same website]** (only with subtle changes).

- Companies can quickly analyze the data, adapt their design, and continue testing features.
]

---
# A/B Testing Jargon

- There's a lot of jargon in A/B testing that is thrown out there...

.box-7[What does it all mean?]

--

.box-5t[Conversions]

.box-4t[Regret]

.box-2t[Multi-armed bandits/ Contextual bandits]

---
# A/B Testing Jargon

- **.darkorange[Conversions]**: "Cause the customer to take action"

- **.darkorange[Regret]**: Loss of conversion due to a low-performing treatment.
--

&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
.box-7[Maximize conversions and minimize regret]

---
# A/B Testing Jargon

- **.darkorange[Multi-armed bandits/ Contextual bandits]**

  - Name comes from machines at casinos.
  - You want to maximize total payout `\(\rightarrow\)` Balance between exploration and exploitation

.center[
![:scale 50%](https://github.com/maibennett/sta235/raw/main/exampleSite/content/Classes/Week4/1_RCT/images/slot-machine.png)]
--

- **.darkorange[Multi-armed bandits]** redirect users to the more successful versions of the treatment.

- A **.darkorange[contextual bandit]** uses prior information from the user to select an action.

---
# A/B Testing in Data: MSU Library

- Montana University Library website: Low interaction with the "Interact" Category
.center[
![:scale 50%](https://github.com/maibennett/sta235/raw/main/exampleSite/content/Classes/Week4/1_RCT/images/montana_control.png)]
---
# A/B Testing in Data: MSU Library
.center[
![:scale 50%](https://github.com/maibennett/sta235/raw/main/exampleSite/content/Classes/Week4/1_RCT/images/heatmap_control.png)]

---
# A/B Testing in Data: Different treatments

- Test four different names for that category

.pull-left[
.center[
![:scale 80%](https://github.com/maibennett/sta235/raw/main/exampleSite/content/Classes/Week4/1_RCT/images/connect.png)

![:scale 80%](https://github.com/maibennett/sta235/raw/main/exampleSite/content/Classes/Week4/1_RCT/images/learn.png)]
]

.pull-right[
.center[
![:scale 80%](https://github.com/maibennett/sta235/raw/main/exampleSite/content/Classes/Week4/1_RCT/images/help.png)

![:scale 80%](https://github.com/maibennett/sta235/raw/main/exampleSite/content/Classes/Week4/1_RCT/images/services.png)]
]

---
# A/B Testing in Data: Analyze results

.center2[
.box-5LA[How would you analyze these results?]]

---
.center[
![:scale 100%](https://github.com/maibennett/sta235/raw/main/exampleSite/content/Classes/Week4/1_RCT/images/google_analytics1.png)]
---
.center[
![:scale 100%](https://github.com/maibennett/sta235/raw/main/exampleSite/content/Classes/Week4/1_RCT/images/google_analytics2.png)]
---
# Homepage click-through
.center[
![:scale 60%](https://github.com/maibennett/sta235/raw/main/exampleSite/content/Classes/Week4/1_RCT/images/click_through.png)]
---
# Drop-off
.center[
![:scale 55%](https://github.com/maibennett/sta235/raw/main/exampleSite/content/Classes/Week4/1_RCT/images/drop_off.png)]
---
# Homepage return
.center[
![:scale 55%](https://github.com/maibennett/sta235/raw/main/exampleSite/content/Classes/Week4/1_RCT/images/homepage_return.png)]

---
# Wrapping things up

- Randomized controlled trials are great... **.darkorange[but not for everything!]**

--

- Randomization buys us **.darkorange[no systematic selection on observables or unobservables]**

  - But things can go wrong, too!
  
--

.box7-LA[Check your assumptions and look out for potential issues!]

---
# Next class

.pull-left[
- Introduction to **.darkorange[observational studies]**

- Selection on **.darkorange[observables]**

- The wonderful world of **.darkorange[matching!]**
]

.pull-right[
![](https://media.giphy.com/media/oF5oUYTOhvFnO/giphy.gif)
]

---
# References

- Angrist, J. and S. Pischke. (2015). "Mastering Metrics". *Chapter 1*.

- Heiss, A. (2020). "Program Evaluation for Public Policy". *Class 7: Randomization and Matching, Course at BYU*

- Imbens, G. and D. Rubin. (2015). "Causal Inference for Statistics, Social, and Biomedical Sciences: An Introduction". *Chapter 1*

- Young, S. (2014). "Improving Library User Experience with A/B Testing: Principles and Process". *Weave. Vol 1, Issue 1.*


&lt;!-- pagedown::chrome_print('C:/Users/mc72574/Dropbox/Hugo/Sites/sta235/exampleSite/content/Classes/Week4/1_RCT/sp2021_sta235_6_RCT.html') --&gt;
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="macros.js"></script>
<script src="cols_macro.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false,
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
