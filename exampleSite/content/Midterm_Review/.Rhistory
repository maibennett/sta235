# scipen=999 removes scientific notation; scipen=0 turns it on.
options(scipen = 0)
### Load libraries
# If you don't have one of these packages installed already, you will need to run install.packages() line
library(tidyverse)
library(modelsummary)
library(ggplot2)
library(estimatr)
################################################################################
### Task 1: Do training programs work?
################################################################################
lalonde <- read.csv("https://raw.githubusercontent.com/maibennett/sta235/main/exampleSite/content/Assignments/Homework/data/hw2/nsw_lalonde_rct.csv")
lalonde
## Question 1.4
lalonde_treat <- lalonde %>% filter(treat == "1")
lalonde_treat
lalonde_control <- lalonde %>% filter(treat =="0")
lalonde_control
## Question 1.5
lalonde_bal <- lalonde %>% select(treat, age, education, black, hispanic, married, nodegree, re75, re78)
datasummary_balance(~ treat, data = lalonde_bal, title = "Balance table", fmt=2, dinm_statistic = "p.value")
?Rcpp
library(tidyverse)
library(ggplot2)
library(estimatr)
library(modelsummary)
d <- read.csv("https://raw.githubusercontent.com/maibennett/sta235/main/exampleSite/content/Classes/Week4/2_RCT/data/lakisha_aer.csv")
d <- d %>% mutate(treat = ifelse(race == "b", 1, 0))
d %>% group_by(treat) %>% count()
d_bal <- d %>% select(treat, education, ofjobs, yearsexp, computerskills, h, l, city)
datasummary_balance(~ treat, data = d_bal, title = "Balance table", fmt=2, dinm_statistic = "p.value")
#everything above here works, but the code below produces the following error:
#`across()` must only be used inside dplyr verbs.
d_bal %>% group_by(treat) %>% summarize(across(.cols = everything(), .fns = mean))
d_bal %>% group_by(treat) %>% dplyr::summarize(across(.cols = everything(), .fns = mean))
packageVersion('dplyr')
library(tidyverse)
library(ggplot2)
library(estimatr)
library(modelsummary)
d <- read.csv("https://raw.githubusercontent.com/maibennett/sta235/main/exampleSite/content/Classes/Week4/2_RCT/data/lakisha_aer.csv")
d <- d %>% mutate(treat = ifelse(race == "b", 1, 0))
d %>% group_by(treat) %>% count()
d_bal <- d %>% select(treat, education, ofjobs, yearsexp, computerskills, h, l, city)
datasummary_balance(~ treat, data = d_bal, title = "Balance table", fmt=2, dinm_statistic = "p.value")
#everything above here works, but the code below produces the following error:
#`across()` must only be used inside dplyr verbs.
d_bal <- d %>% select(treat, education, ofjobs, yearsexp, computerskills, h, l, city)
d_bal %>% group_by(treat) %>% dplyr::summarize(across(.cols = everything(), .fns = mean))
?summarize_all
d_bal %>% group_by(treat) %>% dplyr::summarize_all(.)
d_bal %>% group_by(treat) %>% dplyr::summarize_all(mean)
d_bal %>% group_by(treat) %>% dplyr::summarize_all(.,~mean)
d_bal %>% group_by(treat) %>% dplyr::summarize_all(~mean)
d_bal %>% group_by(treat) %>% dplyr::summarize_all(mean)
library(tidyverse)
library(modelsummary)
library(ggplot2)
ig <- read.csv("https://raw.githubusercontent.com/maibennett/sta235/main/exampleSite/content/Assignments/Homework/data/hw3/instagram.csv")
set.seed(123)
#nrow(ig) is the number of observations I have to assign
ig <- ig %>% mutate(treat = sample(c(0,1), nrow(ig), replace = TRUE, prob = c(0.5, 0.5)))
ig %>% group_by(treat) %>% count()
datasummary_balance(~ treat, data = ig, fmt = 2, title = "IG Balance Table", dinm_statistic = "p.value")
ig_results <- read.csv("https://raw.githubusercontent.com/maibennett/sta235/main/exampleSite/content/Assignments/Homework/data/hw3/instagram_results.csv")
ig_results <- ig_results %>% mutate(ctr = Nclicks/Nviews)
lm1 <- lm(ctr ~ sticker, data = ig_results)
modelsummary(list(CTR = lm1), stars = TRUE, gof_omit = 'DF|AIC|BIC|Log.Lik.|F')
library(MatchIt)
lalonde_cps <- read.csv("https://raw.githubusercontent.com/maibennett/sta235/main/exampleSite/content/Assignments/Homework/data/hw3/lalonde_cps.csv")
lm2 <- lm(re78 ~ treat, data = lalonde_cps)
modelsummary(list(re78 = lm2), stars = TRUE, gof_omit = 'DF|AIC|BIC|Log.Lik.|F')
lalonde_cps_bal <- lalonde_cps %>% select(-re78)
datasummary_balance(~ treat, data = lalonde_cps_bal, fmt = 2, title = "Balance Table", dinm_statistic = "p.value")
lm3 <- lm(re78 ~ treat + age + education + black + hispanic + married + nodegree + re74 + re75, data = lalonde_cps)
modelsummary(list(re78 = lm2, re78 = lm3), stars = TRUE, gof_omit = 'DF|AIC|BIC|Log.Lik.|F')
m_lalonde <- matchit(treat ~ age + education + black + hispanic + married + nodegree + re74 + re75, data = lalonde_cps,
method = "nearest", caliper = 0.25)
t_id <- as.numeric(rownames(m_lalonde$match.matrix))
c_id <- as.numeric(m_lalonde$match.matrix)
lalonde_match <- lalonde_cps %>% slice(c(t_id, c_id))
lalonde_match_bal <- lalonde_match %>% select(-re78)
datasummary_balance(~ treat, data = lalonde_match_bal, fmt = 2, title = "Balance Table", dinm_statistic = "p.value")
lm4 <- lm(re78 ~ treat, data = lalonde_match)
modelsummary(list("re78 (simple)" = lm2, "re78 (multiple)" = lm3, "re78 (matched)" = lm4), stars = TRUE, gof_omit = 'DF|AIC|BIC|Log.Lik.|F')
library(estimatr)
social_insure <- read.csv("https://raw.githubusercontent.com/maibennett/sta235/main/exampleSite/content/Assignments/Homework/data/hw3/social_insure.csv")
social_bal1 <- social_insure %>% select(delay, age, agpop, educ, rice_inc, male, disaster_prob, risk_averse, disaster_yes)
datasummary_balance(~ delay, data = social_bal1, fmt = 2, title = "Balance Table - Delay", dinm_statistic = "p.value")
social_bal2 <- social_insure %>% select(intensive, age, agpop, educ, rice_inc, male, disaster_prob, risk_averse, disaster_yes)
datasummary_balance(~ delay, data = social_bal1, fmt = 2, title = "Balance Table - Intensive", dinm_statistic = "p.value")
lm5 <- lm_robust(takeup_survey ~ intensive, data = social_insure)
modelsummary(list("Insurance take-up" = lm5), stars = TRUE, gof_omit = 'DF|AIC|BIC|Log.Lik.|F')
social1 <- social_insure %>% filter(delay == 0)
social2 <- social_insure %>% filter(delay == 1)
lm6 <- lm_robust(takeup_survey ~ intensive, data = social1)
lm7 <- lm_robust(takeup_survey ~ intensive, data = social2)
modelsummary(list("Insurance take-up (early)" = lm6, "Insurance take-up (later)" = lm7), stars = TRUE, gof_omit = 'DF|AIC|BIC|Log.Lik.|F')
lm8 <- lm_robust(takeup_survey ~ intensive + network_rate_presession + network_obs, data = social2)
modelsummary(list("Insurance take-up (later)" = lm7, "Insurance take-up (later)" = lm8), stars = TRUE, gof_omit = 'DF|AIC|BIC|Log.Lik.|F')
probation <- read.csv("https://raw.githubusercontent.com/maibennett/sta235/main/exampleSite/content/Assignments/Homework/data/hw3/probation.csv")
probation <- read.csv("https://raw.githubusercontent.com/maibennett/sta235/main/exampleSite/content/Assignments/Homework/data/hw3/probation.csv")
lm9 <- lm(GPA_year2 ~ probation_year1 + credits1 + credits_earned1 + GPA_year1 + prog_science + prog_socsci_bus + prog_socscihum + factor(sex) + age_at_entry + hs_grade_pct, data = probation)
modelsummary(list("GPA Year 2" = lm9), stars = TRUE, gof_omit = 'DF|AIC|BIC|Log.Lik.|F')
lm9 <- lm(GPA_year2 ~ probation_year1 + credits1 + credits_earned1 + GPA_year1 + prog_science + prog_socsci_bus + prog_socscihum + factor(sex) + age_at_entry + hsgrade_pct, data = probation)
modelsummary(list("GPA Year 2" = lm9), stars = TRUE, gof_omit = 'DF|AIC|BIC|Log.Lik.|F')
lm9 <- lm_robust(left_school ~ probation_year1, data = probation)
modelsummary(list("Drop out" = lm9), stars = TRUE, gof_omit = 'DF|AIC|BIC|Log.Lik.|F')
##############################################################
### Title: "Week 4 - Randomized Controlled Trials"
### Course: STA 235H
### Semester: Fall 2021
### Professor: Magdalena Bennett
##############################################################
# Clears memory
rm(list = ls())
# Clears console
cat("\014")
### Load libraries
# If you don't have one of these packages installed already, you will need to run install.packages() line
library(tidyverse)
library(ggplot2)
#install.packages(estimatr)
library(estimatr)
library(modelsummary)
## Are Emily and Greg More Employable Than Lakisha and Jamal? Example of an audit study
d <- read.csv("https://raw.githubusercontent.com/maibennett/sta235/main/exampleSite/content/Classes/Week4/2_RCT/data/lakisha_aer.csv")
# Some variables of interest
# education: 0 = not reported; 1 = HSD; 2 = HSG; 3 = Some college; 4 = college +
# ofjobs: Number of jobs listed on resume
# yearsexp: Years of experience
# computerskills: Applicant lists computer skills
# sex: sex of the applicant (according to name)
# race: race-sounding name
# h: high quality resume
# l: low quality resume
# city: c = chicago, b = boston
# call: applicant was called back
## Let's assume we are only interested in the "race" treatment. Create a variable treat = 1 if race = "b" and 0 if race = "w"
d <- d %>% mutate(treat = ifelse(race == "b", 1, 0))
## Q: How many treated observations are there? And how many control?
d %>% group_by(treat) %>% count() # group_by() groups your data according to the different levels of the variables in the argument (in this case, treat).
## Let's check if randomization was done correctly: Balance table
d_bal <- d %>% select(treat, education, ofjobs, yearsexp, computerskills, h, l, city)
datasummary_balance(~ treat, data = d_bal, title = "Balance table", fmt=2, dinm_statistic = "p.value") # Q: Does education make sense as a continuous variable?
# Note that you can obtain the same values for the balance table using tidyverse code:
d_bal %>% group_by(treat) %>% summarize(across(.cols = everything(), .fns = mean)) #across() tells the summarize() function which variables (.cols) to use for summarizing (in this case, everything). We want to get the mean of each variable for treat = 0 and treat = 1. You can change mean for any other variable that you're interested in.
# Q: Why does city return an NA value?
# Let's transform education in a factor variable
d_bal <- d %>% mutate(education = factor(education)) %>% select(treat, education, ofjobs, yearsexp, computerskills, h, l, city)
datasummary_balance(~ treat, data = d_bal, title = "Balance table", fmt=2, dinm_statistic = "p.value")
d <- d %>% mutate(educ_unknown = ifelse(educ==0, 1, 0),
educ_hsd = ifelse(educ==1, 1, 0),
educ_hsg = ifelse(educ==2, 1, 0),
educ_some_college = ifelse(educ=3, 1, 0),
educ_college = ifelse(educ==4, 1, 0))
d <- d %>% mutate(educ_unknown = ifelse(education==0, 1, 0),
educ_hsd = ifelse(education==1, 1, 0),
educ_hsg = ifelse(education==2, 1, 0),
educ_some_college = ifelse(education=3, 1, 0),
educ_college = ifelse(education==4, 1, 0))
d <- d %>% mutate(educ_unknown = ifelse(education==0, 1, 0),
educ_hsd = ifelse(education==1, 1, 0),
educ_hsg = ifelse(education==2, 1, 0),
educ_some_college = ifelse(education==3, 1, 0),
educ_college = ifelse(education==4, 1, 0))
datasummary_balance(~ treat, data = d, title = "Balance table", fmt=2, dinm_statistic = "p.value")
d_bal <- d %>% select(treat, ofjobs, yearsexp, computerskills, h, l, city, educ_college, educ_unknown, educ_hsd, educ_hsg, educ_some_college)
datasummary_balance(~ treat, data = d_bal, title = "Balance table", fmt=2, dinm_statistic = "p.value")
lm9 <- lm(GPA_year2 ~ probation_year1 + credits1 + credits_earned1 + GPA_year1 + prog_science + prog_socsci_bus + prog_socscihum + factor(sex) + age_at_entry + hsgrade_pct, data = probation)
modelsummary(list("GPA Year 2" = lm9), stars = TRUE, gof_omit = 'DF|AIC|BIC|Log.Lik.|F')
# Chunk 1
library(tidyverse)
library(modelsummary)
library(ggplot2)
ig <- read.csv("https://raw.githubusercontent.com/maibennett/sta235/main/exampleSite/content/Assignments/Homework/data/hw3/instagram.csv")
# Chunk 2
set.seed(123)
#nrow(ig) is the number of observations I have to assign
ig <- ig %>% mutate(treat = sample(c(0,1), nrow(ig), replace = TRUE, prob = c(0.5, 0.5)))
ig %>% group_by(treat) %>% count()
# Chunk 3
datasummary_balance(~ treat, data = ig, fmt = 2, title = "IG Balance Table", dinm_statistic = "p.value")
# Chunk 4
ig_results <- read.csv("https://raw.githubusercontent.com/maibennett/sta235/main/exampleSite/content/Assignments/Homework/data/hw3/instagram_results.csv")
# Chunk 5
ig_results <- ig_results %>% mutate(ctr = Nclicks/Nviews)
# Chunk 6
lm1 <- lm(ctr ~ sticker, data = ig_results)
modelsummary(list(CTR = lm1), stars = TRUE, gof_omit = 'DF|AIC|BIC|Log.Lik.|F')
# Chunk 7
library(MatchIt)
lalonde_cps <- read.csv("https://raw.githubusercontent.com/maibennett/sta235/main/exampleSite/content/Assignments/Homework/data/hw3/lalonde_cps.csv")
# Chunk 8
lm2 <- lm(re78 ~ treat, data = lalonde_cps)
modelsummary(list(re78 = lm2), stars = TRUE, gof_omit = 'DF|AIC|BIC|Log.Lik.|F')
# Chunk 9
lalonde_cps_bal <- lalonde_cps %>% select(-re78)
datasummary_balance(~ treat, data = lalonde_cps_bal, fmt = 2, title = "Balance Table", dinm_statistic = "p.value")
# Chunk 10
lm3 <- lm(re78 ~ treat + age + education + black + hispanic + married + nodegree + re74 + re75, data = lalonde_cps)
modelsummary(list(re78 = lm2, re78 = lm3), stars = TRUE, gof_omit = 'DF|AIC|BIC|Log.Lik.|F')
# Chunk 11
m_lalonde <- matchit(treat ~ age + education + black + hispanic + married + nodegree + re74 + re75, data = lalonde_cps,
method = "nearest", caliper = 0.25)
t_id <- as.numeric(rownames(m_lalonde$match.matrix))
c_id <- as.numeric(m_lalonde$match.matrix)
lalonde_match <- lalonde_cps %>% slice(c(t_id, c_id))
# Chunk 12
lalonde_match_bal <- lalonde_match %>% select(-re78)
datasummary_balance(~ treat, data = lalonde_match_bal, fmt = 2, title = "Balance Table", dinm_statistic = "p.value")
# Chunk 13
lm4 <- lm(re78 ~ treat, data = lalonde_match)
modelsummary(list("re78 (simple)" = lm2, "re78 (multiple)" = lm3, "re78 (matched)" = lm4), stars = TRUE, gof_omit = 'DF|AIC|BIC|Log.Lik.|F')
# Chunk 14
library(estimatr)
social_insure <- read.csv("https://raw.githubusercontent.com/maibennett/sta235/main/exampleSite/content/Assignments/Homework/data/hw3/social_insure.csv")
# Chunk 15
social_bal1 <- social_insure %>% select(delay, age, agpop, educ, rice_inc, male, disaster_prob, risk_averse, disaster_yes)
datasummary_balance(~ delay, data = social_bal1, fmt = 2, title = "Balance Table - Delay", dinm_statistic = "p.value")
# Chunk 16
social_bal2 <- social_insure %>% select(intensive, age, agpop, educ, rice_inc, male, disaster_prob, risk_averse, disaster_yes)
datasummary_balance(~ delay, data = social_bal1, fmt = 2, title = "Balance Table - Intensive", dinm_statistic = "p.value")
# Chunk 17
lm5 <- lm_robust(takeup_survey ~ intensive, data = social_insure)
modelsummary(list("Insurance take-up" = lm5), stars = TRUE, gof_omit = 'DF|AIC|BIC|Log.Lik.|F')
# Chunk 18
social1 <- social_insure %>% filter(delay == 0)
social2 <- social_insure %>% filter(delay == 1)
lm6 <- lm_robust(takeup_survey ~ intensive, data = social1)
lm7 <- lm_robust(takeup_survey ~ intensive, data = social2)
modelsummary(list("Insurance take-up (early)" = lm6, "Insurance take-up (later)" = lm7), stars = TRUE, gof_omit = 'DF|AIC|BIC|Log.Lik.|F')
# Chunk 19
lm8 <- lm_robust(takeup_survey ~ intensive + network_rate_presession + network_obs, data = social2)
modelsummary(list("Insurance take-up (later)" = lm7, "Insurance take-up (later)" = lm8), stars = TRUE, gof_omit = 'DF|AIC|BIC|Log.Lik.|F')
# Chunk 20
probation <- read.csv("https://raw.githubusercontent.com/maibennett/sta235/main/exampleSite/content/Assignments/Homework/data/hw3/probation.csv")
# Chunk 21
lm9 <- lm_robust(left_school ~ probation_year1, data = probation)
modelsummary(list("Drop out" = lm9), stars = TRUE, gof_omit = 'DF|AIC|BIC|Log.Lik.|F')
# Chunk 22
lm9 <- lm(GPA_year2 ~ probation_year1 + credits1 + credits_earned1 + GPA_year1 + prog_science + prog_socsci_bus + prog_socscihum + factor(sex) + age_at_entry + hsgrade_pct, data = probation)
modelsummary(list("GPA Year 2" = lm9), stars = TRUE, gof_omit = 'DF|AIC|BIC|Log.Lik.|F')
# Chunk 23
probation_bal <- probation %>% filter(probation_year1==1) %>% select(left_school, credits1, credits_earned1, GPA_year1, prog_science, prog_socsci_bus, prog_socscihum, male, age_at_entry, hsgrade_pct)
datasummary_balance(~ left_school, data = probation_bal, fmt = 2, title = "Balance Table - Intensive", dinm_statistic = "p.value")
lm10 <- lm_robust(left_school ~ probation_year1 + credits1 + credits_earned1 + GPA_year1 + prog_science + prog_socsci_bus + prog_socscihum + factor(sex) + age_at_entry + hsgrade_pct, data = probation)
modelsummary(list("Drop out" = lm10), stars = TRUE, gof_omit = 'DF|AIC|BIC|Log.Lik.|F')
summary(lm10)
table(probation$prog_unknown
)
lm9 <- lm(GPA_year2 ~ probation_year1 + credits1 + credits_earned1 + GPA_year1 + prog_science + prog_socsci_bus + prog_socscihum + factor(sex) + age_at_entry + hsgrade_pct, data = probation)
modelsummary(list("GPA Year 2" = lm9), stars = TRUE, gof_omit = 'DF|AIC|BIC|Log.Lik.|F')
lm10 <- lm_robust(left_school ~ probation_year1 + credits1 + credits_earned1 + GPA_year1 + prog_science + prog_socsci_bus  + factor(sex) + age_at_entry + hsgrade_pct, data = probation)
modelsummary(list("Drop out" = lm10), stars = TRUE, gof_omit = 'DF|AIC|BIC|Log.Lik.|F')
lm10 <- lm_robust(left_school ~ probation_year1 + credits1 + credits_earned1 + GPA_year1 + prog_science + prog_socsci_bus + prog_socscihum + factor(sex) + age_at_entry + hsgrade_pct, data = probation)
modelsummary(list("Drop out" = lm10), stars = TRUE, gof_omit = 'DF|AIC|BIC|Log.Lik.|F')
table(is.na(probation$left_school))
lm10 <- lm_robust(left_school ~ probation_year1 + credits1 + credits_earned1 + GPA_year1 + prog_science + prog_socsci_bus  + factor(sex) + age_at_entry + hsgrade_pct, data = probation)
modelsummary(list("Drop out" = lm10), stars = TRUE, gof_omit = 'DF|AIC|BIC|Log.Lik.|F')
probation_bal <- probation %>% select(left_school, credits1, credits_earned1, GPA_year1, prog_science, prog_socsci_bus, prog_socscihum, male, age_at_entry, hsgrade_pct)
probation_bal %>% summarize(.)
probation_bal <- probation %>% select(left_school, credits1, credits_earned1, GPA_year1, prog_science, prog_socsci_bus, prog_socscihum, male, age_at_entry, hsgrade_pct)
probation_bal %>% summarize(.)
probation_bal %>% colSums(is.na(.)) / nrow(.)
probation_bal %>% colSums(is.na(.))
missing.values <- probation_bal %>%
gather(key = "key", value = "val") %>%
mutate(is.missing = is.na(val)) %>%
group_by(key, is.missing) %>%
summarise(num.missing = n()) %>%
filter(is.missing==T) %>%
select(-is.missing) %>%
arrange(desc(num.missing))
missing.values
probation_bal <- probation %>% filter(probation_year1==1) %>% select(left_school, credits1, credits_earned1, GPA_year1, male, age_at_entry, hsgrade_pct)
datasummary_balance(~ left_school, data = probation_bal, fmt = 2, title = "Balance Table - Intensive", dinm_statistic = "p.value")
lm10 <- lm_robust(left_school ~ probation_year1 + credits1 + credits_earned1 + GPA_year1 + factor(sex) + age_at_entry + hsgrade_pct, data = probation)
modelsummary(list("Drop out" = lm10), stars = TRUE, gof_omit = 'DF|AIC|BIC|Log.Lik.|F')
lm9 <- lm(GPA_year2 ~ probation_year1 + credits1 + credits_earned1 + GPA_year1 + factor(sex) + age_at_entry + hsgrade_pct, data = probation)
modelsummary(list("GPA Year 2" = lm9), stars = TRUE, gof_omit = 'DF|AIC|BIC|Log.Lik.|F')
data_ut <- read.csv("https://raw.githubusercontent.com/maibennett/sta235/main/exampleSite/content/Exams/data/midterm/user_app_installed_UT_large.csv")
wfh <- read.csv("https://raw.githubusercontent.com/maibennett/sta235/main/exampleSite/content/Exams/data/midterm/wfh.csv")
library(tidyverse)
barrels_rct <- read.csv("https://raw.githubusercontent.com/maibennett/sta235/main/exampleSite/content/Exams/data/midterm/barrels_rct.csv") %>%
# This makes it so "No barrel" is the reference category
mutate(barrel = fct_relevel(barrel, "No barrel"))
barrels_obs <- read.csv("https://raw.githubusercontent.com/maibennett/sta235/main/exampleSite/content/Exams/data/midterm/barrels_observational.csv") %>%
# This makes it so "No barrel" is the reference category
mutate(barrel = fct_relevel(barrel, "No barrel"))
barrels_rct <- barrels_rct %>% mutate(home_garden_num = ifelse(home_garden=="Home garden", 1, 0))
barrels_rct_bal <- barrels_rct %>% select(barrel_num, yard_size, home_garden_num, attitude_env, temperature)
library(modelsummary)
datasummary_balance(~ barrel_num, data = barrels_rct_bal, fmt = 3, dinm_statistic = "p.value")
library(estimatr)
lm5 <- lm_robust(installed ~ treat, data = pilot_mc)
modelsummary(list("Installations" = lm5), stars = TRUE, gof_omit = 'DF|AIC|BIC|Log.Lik.|F')
wfh <- read.csv("https://raw.githubusercontent.com/maibennett/sta235/main/exampleSite/content/Exams/data/midterm/wfh.csv")
wfh <- read.csv("https://raw.githubusercontent.com/maibennett/sta235/main/exampleSite/content/Exams/data/midterm/wfh_short.csv")
wfh_all <- read.csv("https://raw.githubusercontent.com/maibennett/sta235/main/exampleSite/content/Exams/data/midterm/wfh_all.csv")
wfh_all <- wfh_all %>% mutate(children = ifelse(children=="yes", 1, 0),
bedroom = ifelse(bedroom=="yes", 1, 0))
wfh_all_bal <- wfh_all %>% select(-personid)
datasummary_balance(~ volunteer, data = wfh_all_bal, fmt = 3, dinm_statistic = "p.value")
wfh_rct <- read.csv("https://raw.githubusercontent.com/maibennett/sta235/main/exampleSite/content/Exams/data/midterm/wfh_short.csv")
wfh_rct <- wfh_rct %>% mutate(children = ifelse(children=="yes", 1, 0),
bedroom = ifelse(bedroom=="yes", 1, 0))
wfh_rct_bal <- wfh_rct %>% select(age, tenure, grosswage, children, bedroom, commute, men, married)
datasummary_balance(~ treatment, data = wfh_rct_bal, fmt = 3, dinm_statistic = "p.value")
wfh_rct <- wfh_rct %>% mutate(children = ifelse(children=="yes", 1, 0),
bedroom = ifelse(bedroom=="yes", 1, 0))
wfh_rct_bal <- wfh_rct %>% select(treatment,age, tenure, grosswage, children, bedroom, commute, men, married)
datasummary_balance(~ treatment, data = wfh_rct_bal, fmt = 3, dinm_statistic = "p.value")
wfh_rct <- read.csv("https://raw.githubusercontent.com/maibennett/sta235/main/exampleSite/content/Exams/data/midterm/wfh_short.csv")
wfh_rct <- wfh_rct %>% mutate(children = ifelse(children=="yes", 1, 0),
bedroom = ifelse(bedroom=="yes", 1, 0))
wfh_rct_bal <- wfh_rct %>% select(treatment,age, tenure, grosswage, children, bedroom, commute, men, married)
datasummary_balance(~ treatment, data = wfh_rct_bal, fmt = 3, dinm_statistic = "p.value")
lm9 <- lm(perform1 ~ treatment, data = wfh_rct)
lm10 <- lm(perform1 ~ treatment + age + tenure + grosswage + children + bedroom + commute + men + married, data = wfh_rct)
modelsummary(list(performance = lm9, performance = lm10), stars = TRUE, gof_omit = 'DF|AIC|BIC|Log.Lik.|F')
wfh_new <- read.csv("https://raw.githubusercontent.com/maibennett/sta235/main/exampleSite/content/Exams/data/midterm/wfh_new.csv")
View(wfh_new)
View(wfh_new)
wfh_all <- wfh_all %>% mutate(children = ifelse(children=="yes", 1, 0),
bedroom = ifelse(bedroom=="yes", 1, 0))
wfh_all_bal <- wfh_all %>% select(-personid)
datasummary_balance(~ volunteer, data = wfh_all_bal, fmt = 3, dinm_statistic = "p.value")
wfh_all <- read.csv("https://raw.githubusercontent.com/maibennett/sta235/main/exampleSite/content/Exams/data/midterm/wfh_all.csv")
wfh_rct <- read.csv("https://raw.githubusercontent.com/maibennett/sta235/main/exampleSite/content/Exams/data/midterm/wfh_short.csv")
wfh_all <- wfh_all %>% mutate(children = ifelse(children=="yes", 1, 0),
bedroom = ifelse(bedroom=="yes", 1, 0))
wfh_all_bal <- wfh_all %>% select(-personid)
datasummary_balance(~ volunteer, data = wfh_all_bal, fmt = 3, dinm_statistic = "p.value")
wfh_rct <- wfh_rct %>% mutate(children = ifelse(children=="yes", 1, 0),
bedroom = ifelse(bedroom=="yes", 1, 0))
wfh_rct_bal <- wfh_rct %>% select(treatment,age, tenure, grosswage, children, bedroom, commute, men, married)
datasummary_balance(~ treatment, data = wfh_rct_bal, fmt = 3, dinm_statistic = "p.value")
wfh_rct %>% group_by(treatment) %>% count()
######################################################################
### Title: "Midterm"
### Course: STA 235H
### Semester: Fall 2021
### Student: Name
#######################################################################
# Clears memory
rm(list = ls())
# Clears console
cat("\014")
# scipen=999 removes scientific notation; scipen=0 turns it on.
options(scipen = 0)
### Load libraries
# If you don't have one of these packages installed already, you will need to run install.packages() line
library(tidyverse)
library(modelsummary)
library(ggplot2)
library(estimatr)
################################################################################
### Task 1: Going green!
################################################################################
barrels_rct <- read.csv("https://raw.githubusercontent.com/maibennett/sta235/main/exampleSite/content/Exams/data/midterm/barrels_rct.csv") %>%
# This makes it so "No barrel" is the reference category
mutate(barrel = fct_relevel(barrel, "No barrel"))
barrels_obs <- read.csv("https://raw.githubusercontent.com/maibennett/sta235/main/exampleSite/content/Exams/data/midterm/barrels_observational.csv") %>%
# This makes it so "No barrel" is the reference category
mutate(barrel = fct_relevel(barrel, "No barrel"))
wfh_rct <- read.csv("https://raw.githubusercontent.com/maibennett/sta235/main/exampleSite/content/Exams/data/midterm/wfh_rct.csv")
wfh_rct <- read.csv("https://raw.githubusercontent.com/maibennett/sta235/main/exampleSite/content/Exams/data/midterm/wfh_short.csv")
.box-2LA[Homework 3 is due on Thursday]
- Remember: **.darkorange[Group collaboration is part of the assignment]**
library(estimatr)
social_insure <- read.csv("https://raw.githubusercontent.com/maibennett/sta235/main/exampleSite/content/Assignments/Homework/data/hw3/social_insure.csv")
summary(social_insure$risk_averse)
################################################################################
### Title: "Week 7 - Diff-in-Diff"
### Course: STA 235H
### Semester: Fall 2021
### Professor: Magdalena Bennett
################################################################################
# Clears memory
rm(list = ls())
# Clears console
cat("\014")
### Load libraries
# If you don't have one of these packages installed already, you will need to
#run install.packages() line
library(tidyverse)
library(ggplot2)
library(estimatr)
library(modelsummary)
library(vtable)
library(did)
###############################################################################
################ Look what Taylor Swift made me do
###############################################################################
# This is simulated data using real Google trends of popularity for Taylor Swift.
# this shows popularity over time, including the release of one of her albums (on the week of 07/19/2020 for the west coast, and 08/09/2020 for the rest).
swift <- read.csv("https://raw.githubusercontent.com/maibennett/sta235/main/exampleSite/content/Classes/Week7/2_DD/data/swift.csv")
# Data shows for each state and week of the year (past 12 months), a popularity index, whether the state belongs to the "west coast" glitch or not, and the week the album was released in each place.
head(swift)
swift <- swift %>% mutate(week = as.numeric(format(as.Date(dates), format = "%W")))
swift <- swift %>% mutate(state_num = as.numeric(factor(state)))
as.numeric(format(as.Date("2020-07-19")
)
)
as.numeric(format(as.Date("2020-07-19"), format = "%W"))
as.numeric(format(as.Date("2020-08-09"), format = "%W"))
# First, create a variable treat that will have the week that state was first treated:
swift <- swift %>% mutate(week.treat = ifelse(west_coast==1, as.numeric(format(as.Date("2020-07-19"), format = "%W")), 0))
# Then, we will transform that same variable treat, but now we are going to assign the weeh of 09/08 to those states
# not in the west coast, after the album was available for everyone (if not, treat is going to be maintained the same)
swift <- swift %>% mutate(week.treat = ifelse(west_coast==0 & controls==0, as.numeric(format(as.Date("2020-08-09"), format = "%W")), week.treat))
View(swift)
?att_gt
dd <- att_gt(yname = "popularity", tname = "week", idname = "state_num",
gname = "week.treat", data = swift)
# This gives us the ATT for each week in our data for the two different groups we have (first one treated on week 28 and 2nd one treated on week 31)
summary(dd)
# And let's look at this beautiful plot!
ggdid(dd)
################################################################################
### Title: Continuous score for GS ratings
### Author: Magdalena Bennett
### Created on: 2021/10/01
### Edit: [MB] - Created script cleaning other files.
################################################################################
# Clears memory
rm(list = ls())
# Clears console
cat("\014")
### Load libraries
library(tidyverse)
library(ggplot2)
# Path to the Dropbox folder on your computer
main_dir_list = c("C:/Users/mc72574/Dropbox/UT/UT Research/GreatSchools/GreatSchools/",
"[ENTER THE PATH WHERE YOU HAVE YOUR DATA ON YOUR MACHINE HERE]")
# Enter your computer's username (recover using Sys.info()[7])
names(main_dir_list) = c("mc72574", "[ENTER YOUT USERNAME HERE (SEE NOTE ABOVE ON HOW TO GET IT)]")
main_dir = main_dir_list[Sys.info()[7]]
# Set the directory where the data is
data_dir = paste0(main_dir,"4_Data/original/Bergman_summary_rating_files/Bergman_summary_rating_files/")
# List the files in that directory (there should be 51, one per state + DC)
files = list.files(data_dir)
# Recover the names of the states
states = substr(files,1,2)
# Four states don't have summary ratings and only have test ratings.
no_summary = c("ak", "az", "me", "vt")
d_list = list()
for(s in 1:length(files)){
# Read the different files
d = read.csv(paste0(data_dir,files[s]))
# State we are working with
state_d = states[s]
# If the state has a summary rating
if(!(state_d %in% no_summary)){
# Create rating*rebal_weight (we need to take a weighted average of the sub-ratings)
d = d %>% mutate(rating_w = rating*rebal_weight)
# Now we create a continuous variable by school id (some are districts and states)
cont_var = d %>% filter(rating_type=="Sub-Rating") %>% group_by(school_id) %>% summarize(rating_cont = sum(rating_w))
# Merge the continuous variable (check that the rounding works)
d = left_join(d, cont_var, by = "school_id")
}
# Store results in a list (each will be named by the state)
d_list[[s]] =  d
names(d_list)[s] = state_d
}
library(tidyverse)
library(modelsummary)
library(AER)
data("math_reform")
head(math_reform)
?AER
library(AER)
?AER
library(bacondecomp)
data("math_reform")
head(math_reform)
setwd("C:/Users/mc72574/Dropbox/UT/Teaching/Spring2021/Midterm/Exercises")
write.csv(math_reform, file = "math_reform.csv", row.names = FALSE)
setwd("C:/Users/mc72574/Dropbox/Hugo/Sites/sta235/exampleSite/content/Midterm_Review")
write.csv(math_reform, file = "math_reform.csv", row.names = FALSE)
library(tidyverse)
library(modelsummary)
math <- read.csv("https://raw.githubusercontent.com/maibennett/sta235/main/exampleSite/content/Midterm_Review/data/math_reform.csv")
head(math)
?math_reform
data(NaturalGas)
write.csv(NaturalGas, file = "NaturalGas.csv", row.names = FALSE)
library(tidyverse)
library(modelsummary)
gas <- read.csv("https://raw.githubusercontent.com/maibennett/sta235/main/exampleSite/content/Midterm_Review/data/NaturalGas.csv")
head(gas)
library(tidyverse)
library(modelsummary)
gas <- read.csv("https://raw.githubusercontent.com/maibennett/sta235/main/exampleSite/content/Midterm_Review/data/NaturalGas.csv")
head(gas)
data("Parade2005")
write.csv(Parade2005, file = "Parade2005.csv", row.names = FALSE)
library(tidyverse)
library(modelsummary)
parade <- read.csv("https://raw.githubusercontent.com/maibennett/sta235/main/exampleSite/content/Midterm_Review/data/Parade.csv")
head(parade)
library(tidyverse)
library(modelsummary)
parade <- read.csv("https://raw.githubusercontent.com/maibennett/sta235/main/exampleSite/content/Midterm_Review/data/Parade2005.csv")
head(parade)
summary(lm(earnings ~ age + gender + celebrity, data = parade))
seatbelts <- read.csv("https://raw.githubusercontent.com/maibennett/sta235/main/exampleSite/content/Exams/data/midterm/USSeatBelts.csv")
seatbelts80 <- seatbelts %>% filter(year>=1983 & year<=1986) %>% filter(state!="NY" & state!="NJ") %>%
mutate(enforce2 = ifelse(enforce=="no",0,1))
seatbelts80 %>% group_by(year, enforce2) %>% summarize(n = n()) %>% mutate(per = n/sum(n))
summary(lm(earnings ~ age + gender*celebrity, data = parade))
