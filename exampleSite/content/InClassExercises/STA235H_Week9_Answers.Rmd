---
title: "Week 9 - In-Class Exercise"
author: "STA 235H - Fall 2022"
date: ""
output: 
  html_document:
    css: style.css
    df_print: "kable"
---
<style type="text/css">
div.main-container {
  max-width: 1800px;
  margin-left: auto;
  margin-right: auto;
}

@media only screen and (max-width: 600px) {
   body {
      margin: 0;
      padding: 0;
   }
   .sample {
      width: 100%;
   }
}
</style>

# Setup

Most (if not all) countries have a minimum legal drinking age (MLDA), and people often ask if this makes sense or not. Should the MLDA be higher or lower or even exist at all? One way to think about this is to look at the external benefits of this, for example in health outcomes or crime.

In this exercise, we will be working with real arrest data from the California Department of Justice's Monthly Arrest and Citation register (MACR) between 1979 and 2006 (data is from paper by Carpenter & Dobkin (2014)) to tackle this question.


```{r, message=FALSE, warning=FALSE}
library(tidyverse)
library(rdrobust)

mlda <- read.csv("https://raw.githubusercontent.com/maibennett/sta235/main/exampleSite/content/InClassExercises/data/mlda.csv")
```

Here's the list of some variables in your dataset:

- `age_days`: Age of the people arrested, in days (we will assume 7670 days = 21 years)
- `all`: Total number of arrests
- `felony`: Total number of felonies arrests
- `murder`: Total number of murder arrests
- `ill_drugs`: Total number of illegal drugs arrests
- `alcohol`: Total number of arrests related to alcohol
- `dump_or_litter`: : Total number of dump or litter arrests
- `female`: Proportion of female arrests (sim)

## Tasks

1) Let's start creating the variables we will need! Create a running variable `r` centered around the 21st birthday (*Hint: You will need to use age and subtract the cuoff*), and a treatment variable `treat` that takes the value of (1) if the person can legally drink and 0 in another case.

```{r}
mlda <- mlda %>% mutate(r = age_days - 7670,
                        treat = ifelse(r>=0, 1, 0))
```

2) Let's do some robustness checks first to make sure we can fit a RDD. Using `rdplot()`, show a plot for a RDD with `treat` as your outcome and `r` as your running variable. Do you see a discontinuity?

```{r}
rdplot(mlda$treat, mlda$r, c = 0)
```

3) Let's do another robustness check, by checking the smoothness of covariates across the threshold. Using `rdplot()` and `rdrobust()`, fit a RDD with `female` as your outcome and `r` as your running variable. Should you see a discontinuity?

```{r}
rdplot(mlda$female, mlda$r, c = 0)
```

```{r}
summary(rdrobust(mlda$female, mlda$r, c = 0))
```


4) Finally, let's calculate an effect! Use a linear model (`lm()`) to estimate the RDD, using `alcohol` as your outcome, and compare it to the results of `rdrobust()`. Include a plot using `rdplot()`. Which one do you think is a better estimate? Interpret your  effect.

```{r}
lm_rd <- lm(alcohol ~ treat*r, data = mlda)

summary(lm_rd)

summary(rdrobust(mlda$alcohol, mlda$r, c = 0))

rdplot(mlda$alcohol, mlda$r, c = 0)
```


5) Let's check also a crime rate that we don't think would necessarily change discontinuisly at the cutoff: Murder. Conduct the same analysis as before using now `murder` as your outcome. Do you find an effect?

```{r}
lm_rd <- lm(murder ~ treat*r, data = mlda)

summary(lm_rd)

summary(rdrobust(mlda$murder, mlda$r, c = 0))

rdplot(mlda$murder, mlda$r, c = 0)
```
